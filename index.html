<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  
  <!-- favicon no formato .ico -->
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">

<script>
  document.addEventListener('contextmenu', e => e.preventDefault());
  document.addEventListener('keydown', e => {
    if (
      e.keyCode === 123 ||
      (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J')) ||
      (e.ctrlKey && e.key === 'U') ||
      ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'c')
    ) {
      e.preventDefault();
    }
  });
</script>


  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pel√≠cula Compat√≠vel</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Google Fonts: Montserrat -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700;900&display=swap" rel="stylesheet">


  <!-- jsPDF para gerar PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
body {
  background-color: #111;
  font-family: 'Montserrat', sans-serif;
  color: white;
  font-weight: 400;    /* peso normal para todo o corpo de texto */
}

    .badge {
      background-color: #e11d48;
      color: white;
      font-size: 0.75rem;
      padding: 0.25rem 0.75rem;
      border-radius: 9999px;
      font-weight: bold;
    }
    .highlight {
      /* Este estilo j√° aplica negrito e uma cor chamativa, e funciona com a anima√ß√£o definida na classe animate-blink */
      font-weight: bold;
      color: #ffea00;
    }
    @keyframes pulse {
      0%, 100% { box-shadow: 0 0 0 0 rgba(255,255,255,0.4); }
      50% { box-shadow: 0 0 0 10px rgba(255,255,255,0); }
    }
    /* Anima√ß√£o para o card 3 Meses (piscar) */
    @keyframes blink {
      0%, 50%, 100% { opacity: 1; }
      25%, 75% { opacity: 0.5; }
    }
    .animate-blink {
      animation: blink 2s infinite;
    }
    /* Estilo Premium para o Menu (underline animado) */
    .premium-link {
      position: relative;
    }
    .premium-link::after {
      content: "";
      position: absolute;
      width: 0%;
      height: 2px;
      bottom: -2px;
      left: 0;
      background-color: #FFC107;
      transition: width 0.3s ease;
    }
    .premium-link:hover::after {
      width: 100%;
    }
    .text-shadow {
      text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
    }
    /* Alerta Importante ‚Äì letra menor e padding reduzido */
    .alert-avisos {
      font-size: 0.875rem;
      padding: 0.75rem;
    }
    /* For√ßar os inputs de texto (exceto e-mail) a exibirem em mai√∫sculas */
    input[type="text"] {
      text-transform: uppercase;
    }
    /* Modal t√≠tulo duplicado em vermelho */
    .modal-duplicate-title {
      color: red;
    }
  </style>

  <!-- Bloqueia clique direito, atalhos para DevTools e Ctrl+C -->
  <script>
     document.addEventListener('contextmenu', e => e.preventDefault());
    document.addEventListener('keydown', e => {
      if (
        e.keyCode === 123 || 
        (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J')) || 
        (e.ctrlKey && e.key === 'U') || 
        ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'c')
      ) {
        e.preventDefault();
      }
    });
  </script>

  <!-- Script para pr√©‚Äëcarregar o e‚Äëmail salvo -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const saved = localStorage.getItem('saved_email');
      if (saved) {
        const emailInput = document.getElementById('email');
        const rememberCb = document.getElementById('rememberEmail');
        if (emailInput && rememberCb) {
          emailInput.value = saved;
          rememberCb.checked = true;
        }
      }
    });
  </script>
</head>
<body>
<div id="debugLog" style="
  position: fixed; bottom: 0; left: 0; right: 0;
  max-height: 150px; overflow-y: auto;
  background: rgba(0,0,0,0.8); color: #fff;
  font-size: 12px; padding: 4px; z-index: 9999;
"></div>

  <!-- Cabe√ßalho -->
  <header class="bg-gradient-to-r from-black to-gray-800 p-6 shadow-xl text-white">
    <div class="max-w-6xl mx-auto flex justify-between items-center">
      <!-- Logo / T√≠tulo -->
      <div class="flex items-center space-x-2">
        <svg class="w-8 h-8 text-yellow-400" fill="none" stroke="currentColor" stroke-width="2"
             viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"></svg>
        <h1 class="text-3xl font-black tracking-widest text-shadow">PEL√çCULA COMPAT√çVEL</h1>
      </div>
      <!-- Menu -->
      <nav class="space-x-6 text-base font-semibold">
        <a href="#introSection" onclick="mostrarInicio()" class="premium-link hover:text-yellow-400 transition">In√≠cio</a>
        <a href="#planosSection" onclick="mostrarPlanos()" class="premium-link hover:text-yellow-400 transition">Planos</a>
        <a href="https://wa.me/utidatecnologia" target="_blank" class="premium-link hover:text-yellow-400 transition">Contato</a>
        <a href="javascript:void(0)" id="menuLogin" onclick="goToLogin()" class="premium-link hover:text-yellow-400 transition">Login</a>
      </nav>
    </div>
  </header>

  <!-- P√°gina Inicial: Introdu√ß√£o -->
  <section id="introSection" class="py-12 bg-[#0b1120] text-white">
    <div class="max-w-7xl mx-auto flex flex-col-reverse md:flex-row items-center px-4 lg:px-8">
      <!-- Texto -->
      <div class="w-full md:w-1/2 text-center md:text-left">
        <h2 class="text-3xl sm:text-4xl font-extrabold text-yellow-400 mb-4">
          <span class="inline-block">üß©</span> Encontre a pel√≠cula certa em segundos
        </h2>
        <p class="text-gray-300 text-lg mb-4">
          Voc√™ trabalha com celular e perde tempo testando pel√≠culas ou pesquisando compatibilidades?<br>
          <span class="font-bold text-white">Esse site √© pra voc√™.</span>
        </p>
        <p class="text-gray-400 mb-4">
          Aqui voc√™ acessa uma <span class="text-yellow-400 font-bold">tabela completa e atualizada</span> com modelos compat√≠veis.<br>
          Economize tempo, evite erros e <span class="text-yellow-400 font-bold">venda mais com seguran√ßa</span>.
        </p>
        <div class="flex flex-wrap justify-center md:justify-start gap-3 mt-4">
          <span class="bg-green-600 text-white px-4 py-1 rounded-full text-sm"‚úîÔ∏è F√°cil de usar</span>
          <span class="bg-green-600 text-white px-4 py-1 rounded-full text-sm">‚úîÔ∏è Sem propagandas</span>
          <span class="bg-green-600 text-white px-4 py-1 rounded-full text-sm">‚úîÔ∏è Atualiza√ß√µes autom√°ticas</span>
        </div>
        <p class="text-white mt-6 text-lg">
          <span class="text-yellow-400 font-bold">A partir de R$ 12,00 por m√™s</span>, voc√™ transforma seu atendimento e ganha confian√ßa no que oferece.
        </p>
      </div>
      <!-- Imagem -->
      <div class="w-full md:w-1/2 flex justify-center mb-8 md:mb-0">
        <img src="pelicua3d.png" alt="Pel√≠culas 3D" class="max-w-xs sm:max-w-sm md:max-w-md lg:max-w-sm xl:max-w-md">
      </div>
    </div>
  </section> <!-- fim de #introSection -->

<section id="promoPedido" class="py-16 bg-gradient-to-r from-yellow-500 to-yellow-600 text-gray-900">
  <div class="max-w-6xl mx-auto px-6 flex flex-col lg:flex-row items-center gap-12">
    <!-- Texto Promocional -->
    <div class="lg:w-1/2 space-y-6">
      <h2 class="text-4xl sm:text-5xl font-extrabold leading-tight relative">
        Muito mais que <span class="text-white">Compatibilidade!</span>
        <span class="absolute -top-4 -left-6 text-yellow-300 text-6xl opacity-30"></span>
      </h2>
      <p class="text-lg sm:text-xl">Assinando nosso plano voc√™ tem:</p>
      <ul class="space-y-4">
        <li class="flex items-start"><svg class="w-6 h-6 text-white mr-2" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19l12-12-1.41-1.41z"/></svg><span>Acesso ilimitado √† tabela completa de modelos compat√≠veis</span></li>
        <li class="flex items-start"><svg class="w-6 h-6 text-white mr-2" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19l12-12-1.41-1.41z"/></svg><span>Ferramenta de pedido integrada</span></li>
        <li class="flex items-start"><svg class="w-6 h-6 text-white mr-2" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19l12-12-1.41-1.41z"/></svg><span>PDF de pedido pronto para enviar ao fornecedor em segundos</span></li>
      </ul>
      <button onclick="mostrarPlanos()" class="mt-6 bg-gray-900 text-yellow-400 px-10 py-4 rounded-full font-extrabold shadow-lg transform hover:scale-105 transition duration-300">
        Quero este Plano e o Pedido Autom√°tico
      </button>
    </div>
    <!-- Imagens Responsivas -->
    <div class="lg:w-1/2">
      <!-- Overlay desktop -->
      <div class="hidden lg:block relative h-80">
        <figure class="absolute top-0 left-0 w-2/3 bg-white rounded-xl shadow-lg overflow-hidden transform -rotate-3 hover:rotate-0 transition duration-500 z-10 cursor-pointer promo-image" data-src="https://raw.githubusercontent.com/castriker/site-peliculas/main/pedido%20de%20peliculas.jpg">
          <img src="https://raw.githubusercontent.com/castriker/site-peliculas/main/pedido%20de%20peliculas.jpg" class="w-full h-full object-cover" alt="Pedido de Pel√≠culas">
        </figure>
        <figure class="absolute bottom-0 left-1/4 w-2/3 bg-white rounded-xl shadow-lg overflow-hidden transform rotate-3 hover:rotate-0 transition duration-500 z-10 cursor-pointer promo-image" data-src="https://raw.githubusercontent.com/castriker/site-peliculas/main/modelo%20compativel.jpg">
          <img src="https://raw.githubusercontent.com/castriker/site-peliculas/main/modelo%20compativel.jpg" class="w-full h-full object-cover" alt="Modelo Compat√≠vel">
        </figure>
        <figure class="absolute inset-y-1/4 right-0 w-2/3 bg-white rounded-xl shadow-2xl overflow-hidden transform hover:scale-105 transition duration-500 z-20 cursor-pointer promo-image" data-src="https://raw.githubusercontent.com/castriker/site-peliculas/main/area%20de%20pedidos.jpg">
          <img src="https://raw.githubusercontent.com/castriker/site-peliculas/main/area%20de%20pedidos.jpg" class="w-full h-full object-cover" alt="√Årea de Pedidos">
        </figure>
      </div>
      <!-- Carousel mobile -->
      <div class="block lg:hidden flex space-x-4 overflow-x-auto py-4 scroll-smooth">
        <img src="https://raw.githubusercontent.com/castriker/site-peliculas/main/pedido%20de%20peliculas.jpg" class="w-64 flex-shrink-0 rounded-xl shadow-lg cursor-pointer promo-image" data-src="https://raw.githubusercontent.com/castriker/site-peliculas/main/pedido%20de%20peliculas.jpg" alt="Pedido de Pel√≠culas">
        <img src="https://raw.githubusercontent.com/castriker/site-peliculas/main/modelo%20compativel.jpg" class="w-64 flex-shrink-0 rounded-xl shadow-lg cursor-pointer promo-image" data-src="https://raw.githubusercontent.com/castriker/site-peliculas/main/modelo%20compativel.jpg" alt="Modelo Compat√≠vel">
        <img src="https://raw.githubusercontent.com/castriker/site-peliculas/main/area%20de%20pedidos.jpg" class="w-64 flex-shrink-0 rounded-xl shadow-lg cursor-pointer promo-image" data-src="https://raw.githubusercontent.com/castriker/site-peliculas/main/area%20de%20pedidos.jpg" alt="√Årea de Pedidos">
      </div>
    </div>
  </div>
  <!-- Lightbox Modal -->
  <div id="imageModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50">
    <button id="closeModal" class="absolute top-6 right-6 text-white text-3xl font-bold">√ó</button>
    <img id="modalImage" class="max-w-[90vw] max-h-[90vh] object-contain" alt="Imagem ampliada">
  </div>
  <script>
    document.querySelectorAll('.promo-image').forEach(el => el.addEventListener('click', () => {
      document.getElementById('modalImage').src = el.getAttribute('data-src');
      document.getElementById('imageModal').classList.remove('hidden');
    }));
    document.getElementById('closeModal').addEventListener('click', () => document.getElementById('imageModal').classList.add('hidden'));
    document.getElementById('imageModal').addEventListener('click', e => { if (e.target.id === 'imageModal') e.currentTarget.classList.add('hidden'); });
  </script>
</section>



  <!-- Se√ß√£o de Planos -->
  <section
  id="planosSection"
  class="flex overflow-x-auto gap-4 px-4 sm:px-8 py-8 lg:grid lg:grid-cols-4 max-w-7xl mx-auto"
>
  <!-- Card 1 M√™s -->
  <div class="relative min-w-[80%] lg:min-w-0 flex-shrink-0 bg-white text-black rounded-xl p-6 shadow-md flex flex-col justify-between text-center">
    <div>
      <div class="badge bg-gray-300 text-gray-800 absolute top-2 right-2">0% OFF</div>
      <h3 class="text-lg sm:text-xl font-bold">1 M√™s</h3>
      <p class="text-3xl sm:text-4xl font-extrabold mt-2">R$ 16,00</p>
      <p class="text-sm text-gray-600 mb-3">Total: R$ 16,00</p>
      <ul class="text-sm sm:text-base mb-6 text-left space-y-1">
        <li>üìÑ Acesso √† tabela completa</li>
        <li>üîÑ Atualiza√ß√µes autom√°ticas</li>
        <li>üö´ Sem propagandas</li>
      </ul>
    </div>
    <button onclick="window.open('https://mpago.la/1CFqLVk', '_blank')"
            class="w-full bg-black text-white py-3 rounded-lg font-semibold hover:opacity-80 transition text-sm sm:text-base">
      üí≥ Comprar
    </button>
  </div>

<!-- Card 3 Meses (pisca) -->
<div
  class="relative
         min-w-[80%] lg:min-w-0 flex-shrink-0    /* largura carrossel no mobile */
         bg-[#fffbea] text-black rounded-xl p-6
         text-center shadow-[0_0_25px_rgba(255,204,0,0.5)]
         border-2 border-yellow-400
         flex flex-col justify-between
         animate-blink"
>
  <!-- Selo Mais Vendido -->
  <div class="absolute -top-4 left-1/2 transform -translate-x-1/2
              bg-yellow-400 text-black px-3 py-1 rounded-full text-xs shadow-lg">
    MAIS VENDIDO
  </div>

  <!-- T√≠tulo e valores -->
  <h3 class="text-xl font-normal flex justify-center items-center gap-2">‚≠ê 3 Meses</h3>
  <p class="text-3xl font-normal mt-2">R$ 14,00</p>
  <p class="text-sm text-gray-600 mb-3 font-normal">Total: R$ 42,00</p>

  <!-- Lista de benef√≠cios -->
  <ul class="text-sm sm:text-base mb-4 text-left space-y-1 font-normal">
    <li>üìÑ Acesso √† tabela completa</li>
    <li>üîÑ Atualiza√ß√µes autom√°ticas</li>
    <li>üö´ Sem propagandas</li>
  </ul>

  <!-- Bot√£o -->
  <button
    onclick="window.open('https://mpago.la/1DTP1fB', '_blank')"
    class="w-full bg-black text-white py-3 rounded-lg font-semibold hover:opacity-80 transition text-sm sm:text-base"
  >
    üí≥ Comprar
  </button>
</div>

  <!-- Card 6 Meses -->
 <div class="relative min-w-[80%] lg:min-w-0 flex-shrink-0 bg-white text-black rounded-xl p-6 shadow-md flex flex-col justify-between text-center">

    <div>
      <div class="badge absolute top-2 right-2">18,75% OFF</div>
      <h3 class="text-lg sm:text-xl font-bold">6 Meses</h3>
      <p class="text-3xl sm:text-4xl font-extrabold mt-2">R$ 13,00</p>
      <p class="text-sm text-gray-600 mb-3">Total: R$ 78,00</p>
      <ul class="text-sm sm:text-base mb-6 text-left space-y-1">
        <li>üìÑ Acesso √† tabela completa</li>
        <li>üîÑ Atualiza√ß√µes autom√°ticas</li>
        <li>üö´ Sem propagandas</li>
      </ul>
    </div>
    <button onclick="window.open('https://mpago.la/2yYjQtG', '_blank')"
            class="w-full bg-black text-white py-3 rounded-lg font-semibold hover:opacity-80 transition text-sm sm:text-base">
      üí≥ Comprar
    </button>
  </div>

  <!-- Card 1 Ano -->
<div class="relative min-w-[80%] lg:min-w-0 flex-shrink-0 bg-white text-black rounded-xl p-6 shadow-md flex flex-col justify-between text-center">

    <div>
      <div class="badge absolute top-2 right-2">25% OFF</div>
      <h3 class="text-lg sm:text-xl font-bold">1 Ano</h3>
      <p class="text-3xl sm:text-4xl font-extrabold mt-2">R$ 12,00</p>
      <p class="text-sm text-gray-600 mb-3">Total: R$ 144,00</p>
      <ul class="text-sm sm:text-base mb-6 text-left space-y-1">
        <li>üìÑ Acesso √† tabela completa</li>
        <li>üîÑ Atualiza√ß√µes autom√°ticas</li>
        <li>üö´ Sem propagandas</li>
      </ul>
    </div>
    <button onclick="window.open('https://mpago.la/2e4ENYH', '_blank')"
            class="w-full bg-black text-white py-3 rounded-lg font-semibold hover:opacity-80 transition text-sm sm:text-base">
      üí≥ Comprar
    </button>
  </div>
</section>


  <!-- Se√ß√£o de Pedidos -->
  <section id="orderSection" class="hidden max-w-4xl mx-auto mt-10 p-4">
    <div class="mb-4 bg-gray-800 text-center p-4 rounded-lg">
      <strong>√Årea de Pedidos</strong>
    </div>
<div class="bg-gray-700 p-4 rounded-lg mb-4">
  <div class="flex flex-wrap items-center gap-2">
    <!-- Label do modelo -->
    <label for="orderModelo" class="text-sm font-medium whitespace-nowrap">
      Modelo da pel√≠cula
    </label>

    <!-- Input de modelo (menor largura) -->
    <input
      type="text"
      id="orderModelo"
      placeholder="ex: A10"
      class="flex-1 max-w-xs p-2 text-black rounded-lg"
    />

    <!-- Label da quantidade abreviada -->
    <label for="orderQuantidade" class="text-sm font-medium whitespace-nowrap">
      Quantidade
    </label>

    <!-- Input de quantidade (fixo) -->
    <input
      type="number"
      id="orderQuantidade"
      placeholder="Ex. 1"
      class="w-16 p-2 text-black rounded-lg"
      min="1"
    />

    <!-- Bot√£o de adicionar -->
    <button
      onclick="adicionarPedido()"
      class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded text-sm"
    >
      Adicionar
    </button>
  </div>

  <!-- mant√©m o resultado da busca aqui -->
  <div id="orderResult" class="hidden p-2 bg-gray-600 rounded-lg text-sm text-white font-light leading-relaxed mt-2"></div>
</div>

    <div class="bg-gray-700 p-4 rounded-lg">
      <h3 class="text-lg font-semibold mb-2">Itens do Pedido</h3>
      <div id="pedidoItens" class="text-sm">
        <p class="text-gray-300">Nenhum item adicionado ainda.</p>
      </div>
      <button onclick="gerarPDFPedido()" class="mt-4 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded transition text-sm sm:text-base">
        Gerar PDF do Pedido
      </button>
<button onclick="voltarConsulta()"
        class="mt-2 bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 px-4 rounded transition text-sm sm:text-base">
  ‚Üê Voltar √† Consulta
</button>
<button onclick="limparPedido()"
        class="mt-2 bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded transition text-sm sm:text-base">
  Limpar Pedido
</button>
<button id="btnSalvarPedido"
        class="mt-2 bg-yellow-500 hover:bg-yellow-600 text-white font-semibold py-2 px-4 rounded text-sm sm:text-base">
  üíæ Salvar Pedido
</button>


    </div>
  </section>

  <!-- √Årea de Login -->
  <section id="loginArea" class="max-w-4xl mx-auto p-4 sm:p-6 hidden">
    <label class="block mb-2 font-medium text-sm sm:text-base">Digite seu e‚Äëmail para acessar</label>
    <input type="email" id="email" placeholder="Digite seu e‚Äëmail" class="w-full p-3 text-black rounded-lg mb-2 text-sm sm:text-base" />
    <div class="mb-4">
      <label class="inline-flex items-center space-x-2 text-sm">
        <input type="checkbox" id="rememberEmail" class="text-blue-600 border-gray-300 rounded focus:ring-0" />
        <span>Lembrar meu e‚Äëmail</span>
      </label>
    </div>
    <button onclick="checkEmail()"
            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg shadow-md border border-blue-500 transition text-sm sm:text-base">
      üîê Entrar
    </button>
  </section>

  <!-- √Årea de Busca (Compatibilidade) -->
  <section id="searchSection" class="hidden max-w-4xl mx-auto mt-10 p-4">
    <div class="mb-4 bg-gray-800 text-center p-4 rounded-lg">
      <strong id="welcomeMsg">Bem-vindo(a)!</strong>
    </div>
    <div class="mb-4 bg-red-600 text-white alert-avisos rounded-lg">
      <strong>Aviso Importante:</strong> Ao aplicar qualquer pel√≠cula, me√ßa cuidadosamente o tamanho, verifique bordas, localiza√ß√£o de c√¢mera e demais recortes pois pode haver diferen√ßa nas pel√≠culas de acordo com o fabricante. O site isenta-se de quaisquer responsabilidades.
    </div>
    <label class="block mb-2 text-sm font-medium">Digite o modelo do celular</label>
    <input type="text" id="searchModel" placeholder="Digite o modelo" class="w-full p-3 text-black rounded-lg mb-4"/>
    <div id="result" class="p-4 bg-gray-700 rounded-lg hidden font-light leading-relaxed"></div>

    <!-- Bot√µes da √°rea de busca -->
    <div class="flex flex-col sm:flex-row gap-2">
      <button onclick="abrirModalIncompatibilidade()" class="bg-yellow-400 hover:bg-yellow-500 text-black font-semibold py-2 px-4 rounded transition text-sm sm:text-base">
        Relatar Incompatibilidade
      </button>
      <button onclick="abrirModalCompatibilidade()" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded transition text-sm sm:text-base">
        Adicionar Compatibilidade
      </button>
      <button onclick="mostrarPedidos()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded transition text-sm sm:text-base">
        Fazer Pedido
      </button>
    </div>
  </section>

  <!-- Modal de Relatar Incompatibilidade -->
  <div id="modalIncompatibilidade" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50">
    <div class="bg-white text-black w-11/12 max-w-sm p-6 rounded shadow-lg">
      <h2 class="text-lg font-bold mb-4">Relatar Incompatibilidade</h2>
      <label class="block mb-2 text-sm font-medium" for="modeloTestado">Modelo testado</label>
      <input type="text" id="modeloTestado" class="w-full p-2 mb-4 rounded border border-gray-300 text-sm sm:text-base" placeholder="Ex: IPHONE 14" />
      <label class="block mb-2 text-sm font-medium" for="modeloIncompativel">Modelo incompat√≠vel</label>
      <input type="text" id="modeloIncompativel" class="w-full p-2 mb-4 rounded border border-gray-300 text-sm sm:text-base" placeholder="Ex: SAMSUNG A10" />
      <div class="flex justify-end space-x-2">
        <button onclick="fecharModalIncompatibilidade()" class="bg-gray-300 hover:bg-gray-400 text-black font-semibold py-2 px-4 rounded">
          Fechar
        </button>
        <button onclick="enviarIncompatibilidade()" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded">
          Enviar
        </button>
      </div>
    </div>
  </div>

  <!-- Modal de Adicionar Compatibilidade -->
  <div id="modalCompatibilidade" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50">
    <div class="bg-white text-black w-11/12 max-w-sm p-6 rounded shadow-lg">
      <h2 class="text-lg font-bold mb-4">Adicionar Compatibilidade</h2>
      <label class="block mb-2 text-sm font-medium" for="modeloProcuradoCompat">Modelo Procurado</label>
      <input type="text" id="modeloProcuradoCompat" class="w-full p-2 mb-4 rounded border border-gray-300 text-sm sm:text-base" placeholder="MODELO PESQUISADO" />
      <label class="block mb-2 text-sm font-medium" for="modeloCompativel">Modelo Compat√≠vel</label>
      <input type="text" id="modeloCompativel" class="w-full p-2 mb-4 rounded border border-gray-300 text-sm sm:text-base" placeholder="Ex: SAMSUNG GALAXY A10" />
      <div class="flex justify-end space-x-2">
        <button onclick="fecharModalCompatibilidade()" class="bg-gray-300 hover:bg-gray-400 text-black font-semibold py-2 px-4 rounded">
          Fechar
        </button>
        <button onclick="enviarCompatibilidade()" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded">
          Enviar
        </button>
      </div>
    </div>
  </div>

<!-- Modal de Duplicata -->
<div id="modalDuplicate" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50">
  <div class="bg-white text-black w-11/12 max-w-sm p-6 rounded shadow-lg">
    <h2 class="text-lg font-bold mb-4 modal-duplicate-title">ITEM DUPLICADO</h2>
    <p id="duplicateMessage" class="mb-4 text-sm"></p>
    <div class="flex justify-end space-x-2">
      <button onclick="cancelarDuplicata()" class="bg-gray-300 ‚Ä¶">Cancelar</button>
    <button onclick="alterarQtdDuplicado()" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded">
  Alterar Quantidade
</button>
      <button onclick="adicionarMesmoModelo()" class="bg-green-600 ‚Ä¶">Adicionar Mesmo Assim</button>
    </div>
  </div>
</div>


  <!-- Rodap√© Principal -->
  <footer class="text-center text-gray-400 text-sm py-8">
    Copyright &copy; 2021 UTI Da Tecnologia - Todos os Direitos Reservados.
    <br>Desenvolvido por <strong>Carla Vasconcelos</strong> (UTI Da Tecnologia).
  </footer>

  <!-- Rodap√© Legal -->
  <footer class="bg-gray-900 text-gray-400 text-sm py-4">
    <div class="max-w-6xl mx-auto flex justify-center space-x-8">
      <a href="javascript:void(0)" onclick="mostrarLegal('quem-somos')" class="hover:text-yellow-400">Quem Somos</a>
      <a href="javascript:void(0)" onclick="mostrarLegal('termos-uso')" class="hover:text-yellow-400">Termos de Uso</a>
      <a href="javascript:void(0)" onclick="mostrarLegal('politica-privacidade')" class="hover:text-yellow-400">Pol√≠tica de Privacidade</a>
    </div>
  </footer>

  <!-- Se√ß√µes Legais (ocultas) -->
  <section id="legalContentContainer" class="max-w-6xl mx-auto py-8 px-4 hidden">
    <div id="quem-somos" class="legal-section hidden">
      <h2 class="text-2xl font-bold text-yellow-400 mb-4">Quem Somos</h2>
      <p>Somos a UTI Da Tecnologia, uma equipe especializada em fornecer informa√ß√µes atualizadas sobre pel√≠culas compat√≠veis para dispositivos m√≥veis. Nossa miss√£o √© facilitar o acesso √†s informa√ß√µes e ajudar profissionais no atendimento e venda de pel√≠culas com qualidade e confiabilidade. Liderada por Carla Vasconcelos, nossa empresa √© comprometida em oferecer sempre o melhor para nossos clientes.</p>
    </div>
    <div id="termos-uso" class="legal-section hidden border-t border-gray-700 mt-8 pt-8">
      <h2 class="text-2xl font-bold text-yellow-400 mb-4">Termos de Uso</h2>
      <p>Bem-vindo ao site Pel√≠culas Compat√≠veis. Ao acessar ou utilizar nosso site, voc√™ concorda em cumprir e aceitar integralmente os presentes Termos de Uso. Caso discorde de algum item, solicitamos que n√£o utilize este site.</p>
      <h3 class="text-xl font-bold mt-4">1. Utiliza√ß√£o do Site</h3>
      <p>Este site foi desenvolvido com o objetivo de fornecer informa√ß√µes detalhadas e precisas sobre pel√≠culas compat√≠veis com diversos modelos de dispositivos eletr√¥nicos. Voc√™ deve utilizar este site exclusivamente para fins leg√≠timos, garantindo n√£o infringir direitos de terceiros ou causar qualquer preju√≠zo ao site ou aos demais usu√°rios.</p>
      <p>√â expressamente proibido:</p>
      <ul class="list-disc pl-5">
        <li>Acessar o site por meio de m√©todos ilegais ou n√£o autorizados;</li>
        <li>Realizar qualquer a√ß√£o que possa sobrecarregar ou prejudicar a infraestrutura do site;</li>
        <li>Utilizar ferramentas ou softwares para extrair conte√∫do ou dados sem autoriza√ß√£o pr√©via por escrito.</li>
      </ul>
      <h3 class="text-xl font-bold mt-4">2. Propriedade Intelectual</h3>
      <p>Todo o conte√∫do dispon√≠vel neste site, incluindo textos, imagens, gr√°ficos, logotipos, √≠cones, √°udios e v√≠deos, √© propriedade exclusiva deste site e est√° protegido pelas leis nacionais e internacionais de direitos autorais e propriedade intelectual.</p>
      <p>√â terminantemente proibido reproduzir, distribuir, modificar ou comercializar qualquer conte√∫do do site sem consentimento pr√©vio e expresso do administrador.</p>
      <h3 class="text-xl font-bold mt-4">3. Responsabilidade e Garantias</h3>
      <p>O site Pel√≠culas Compat√≠veis disponibiliza conte√∫do informativo com o maior rigor poss√≠vel, por√©m n√£o oferece garantias expressas ou impl√≠citas quanto √† exatid√£o, integridade ou adequa√ß√£o dessas informa√ß√µes.</p>
      <p>O uso das informa√ß√µes disponibilizadas √© de responsabilidade exclusiva do usu√°rio. Em hip√≥tese alguma seremos responsabilizados por quaisquer danos diretos, indiretos ou consequenciais decorrentes do uso ou da impossibilidade de uso do site, incluindo falhas t√©cnicas ou problemas causados por v√≠rus ou outras amea√ßas digitais.</p>
      <h3 class="text-xl font-bold mt-4">4. Modifica√ß√£o dos Termos</h3>
      <p>Reservamo-nos o direito de modificar ou atualizar estes Termos de Uso a qualquer momento e sem aviso pr√©vio. As altera√ß√µes ser√£o imediatamente v√°lidas ap√≥s a publica√ß√£o em nosso site. A continuidade do uso ap√≥s a publica√ß√£o das modifica√ß√µes implica a aceita√ß√£o dos novos termos.</p>
      <h3 class="text-xl font-bold mt-4">5. Lei Aplic√°vel e Jurisdi√ß√£o</h3>
      <p>Os presentes Termos de Uso s√£o regidos e interpretados segundo as leis vigentes no Brasil. Eventuais disputas relacionadas a estes termos ser√£o resolvidas no foro da cidade sede da administra√ß√£o do site, com ren√∫ncia expressa a qualquer outro.</p>
      <h3 class="text-xl font-bold mt-4">6. Contato</h3>
      <p>Em caso de d√∫vidas sobre estes Termos de Uso ou sobre o funcionamento do site, entre em contato pela aba "Contato".</p>
      <p class="mt-4">√öltima atualiza√ß√£o: 14/04/2025</p>
    </div>
    <div id="politica-privacidade" class="legal-section hidden border-t border-gray-700 mt-8 pt-8">
      <h2 class="text-2xl font-bold text-yellow-400 mb-4">Pol√≠tica de Privacidade</h2>
      <p>Sua privacidade √© nossa prioridade. Nesta Pol√≠tica de Privacidade, explicamos como coletamos, usamos e protegemos suas informa√ß√µes quando voc√™ utiliza o site Pel√≠culas Compat√≠veis.</p>
      <h3 class="text-xl font-bold mt-4">1. Coleta de Informa√ß√µes</h3>
      <p>Coletamos informa√ß√µes pessoais quando voc√™ se registra, faz login ou utiliza determinados servi√ßos do site. Essas informa√ß√µes podem incluir seu nome, e‚Äëmail, endere√ßo IP e dados de uso.</p>
      <h3 class="text-xl font-bold mt-4">2. Uso das Informa√ß√µes</h3>
      <p>Utilizamos os dados coletados para melhorar a experi√™ncia do usu√°rio, fornecer suporte, enviar comunica√ß√µes relevantes e assegurar o bom funcionamento do site. N√£o compartilhamos seus dados pessoais com terceiros sem o seu consentimento, exceto quando exigido por lei.</p>
      <h3 class="text-xl font-bold mt-4">3. Seguran√ßa</h3>
      <p>Adotamos medidas t√©cnicas e administrativas para proteger suas informa√ß√µes contra acessos n√£o autorizados, divulga√ß√£o, altera√ß√£o ou destrui√ß√£o. Contudo, nenhum m√©todo de transmiss√£o ou armazenamento √© 100% seguro.</p>
      <h3 class="text-xl font-bold mt-4">4. Cookies</h3>
      <p>Utilizamos cookies para melhorar sua experi√™ncia, armazenar prefer√™ncias e coletar informa√ß√µes anal√≠ticas sobre o uso do site. Voc√™ pode desativar os cookies, mas isso pode afetar a funcionalidade do site.</p>
      <h3 class="text-xl font-bold mt-4">5. Altera√ß√µes nesta Pol√≠tica</h3>
      <p>Podemos atualizar esta Pol√≠tica de Privacidade periodicamente, e a vers√£o atualizada estar√° dispon√≠vel nesta p√°gina. O uso cont√≠nuo do site implica a aceita√ß√£o das altera√ß√µes.</p>
      <h3 class="text-xl font-bold mt-4">6. Contato</h3>
      <p>Se tiver d√∫vidas sobre esta Pol√≠tica de Privacidade, entre em contato pela aba "Contato".</p>
      <p class="mt-4">√öltima atualiza√ß√£o: 14/04/2025</p>
    </div>
    <div class="text-center mt-4">
      <button onclick="fecharLegal()" class="bg-blue-600 text-white py-2 px-4 rounded">Fechar</button>
    </div>
  </section>

  <script>
const supabaseUrl = "https://chjdjfycylqhxtfrbdxm.supabase.co";
  const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNoamRqZnljeWxxaHh0ZnJiZHhtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDIxNTg0MTYsImV4cCI6MjA1NzczNDQxNn0.GvMeSnBDF0CS9-uampycS-C4qqfMgTzSsjYGqHrOFXU";

function generateToken() {
  return Date.now().toString() + Math.random().toString(36).substr(2, 8);
}

function formatarData(dataString) {
  const partes = dataString.split("-");
  if (partes.length === 3) {
    return `${partes[2]}/${partes[1]}/${partes[0]}`;
  }
  return dataString;
}

function getBrasiliaISOString() {
  const now = new Date();
  now.setHours(now.getHours() - 3);
  return now.toISOString().slice(0, 19).replace('T', ' ');
}




    /* 2) Vari√°veis e Estruturas */
    let data = [];        // Base de compatibilidade
    let orderItems = [];  // Itens do pedido
	let duplicateGroup = [];
    let duplicateIndex = -1;




    /* 3) Carregar dados da planilha */
    function loadData() {
      fetch('https://script.google.com/macros/s/AKfycbwiDM-VA66hS8pnAGghwY2vxL3vqrRp9SIHmGc5AkwlMZeMYXg_An3dCvoJQUq6mJWTuA/exec')
        .then(response => response.json())
        .then(jsonData => {
          data = jsonData.map(row =>
            row[0].trim().toUpperCase().split(',').map(m => m.trim())
          );
        });
    }

    /* 4) PESQUISA NA ABA DE COMPATIBILIDADE (searchModel) */
    document.getElementById('searchModel').addEventListener('input', function() {
      const input = this.value.toUpperCase().trim();
      const resultElement = document.getElementById('result');
      if (!input) {
        resultElement.classList.add('hidden');
        return;
      }
     let foundRows = data.flatMap(row =>
  row.some(model => model.includes(input))
    ? [`<span class="font-bold">Modelo Procurado:</span> <span class="font-bold">${input}</span><br>
<span class="font-bold">Modelos Compat√≠veis:</span>
 ${row.map(m =>
        m.includes(input)
          ? m.replace(new RegExp(input, 'g'),
              match => `<span class="highlight animate-blink">${match}</span>`)
          : m
      ).join(', ')}`]
    : []
);


      resultElement.innerHTML = foundRows.length > 0 ? foundRows.join('<br><br>') : "<strong>Modelo n√£o encontrado</strong>";
      resultElement.classList.remove('hidden');
    });

        /* 5) PESQUISA NA ABA DE PEDIDOS (orderModelo) */
document.getElementById('orderModelo').addEventListener('input', function() {
  const input = this.value.toUpperCase().trim();
  const orderResult = document.getElementById('orderResult');
  if (!input) {
    orderResult.classList.add('hidden');
    orderResult.innerHTML = "";
    return;
  }
  // monta as linhas encontradas, s√≥ com input destacado e piscando
  let foundRows = data.flatMap(row =>
    row.some(model => model.includes(input))
      ? [
          row.map(m => {
            // apenas o trecho exato input fica em highlight+piscando
            const display = m.includes(input)
              ? m.replace(new RegExp(input, 'g'),
                  match => `<span class="highlight animate-blink">${match}</span>`)
              : m;
            return `<span class="cursor-pointer" onclick="preencherModelo('${m}')">${display}</span>`;
          }).join(', ')
        ]
      : []
  );
  if (foundRows.length > 0) {
    orderResult.classList.remove('hidden');
    orderResult.innerHTML = foundRows.join('<br><br>');
  } else {
    orderResult.classList.add('hidden');
  }
});
function preencherModelo(valor) {
  document.getElementById('orderModelo').value = valor;
}
  function cancelarDuplicata() {
      document.getElementById('modalDuplicate').classList.add('hidden');
      duplicateIndex = -1;
      duplicateGroup = [];
    }

    function alterarQuantidades() {
      document.getElementById('modalDuplicate').classList.add('hidden');
      if (duplicateMode === 'exact' && duplicateIndex >= 0) {
        exibirInputEdicao(duplicateIndex);
      }
      if (duplicateMode === 'group') {
        duplicateGroup.forEach(i => exibirInputEdicao(i));
      }
      duplicateIndex = -1;
      duplicateGroup = [];
    }

    function adicionarMesmoModelo() {
      document.getElementById('modalDuplicate').classList.add('hidden');
      const modelo = document.getElementById('orderModelo').value.trim();
      const qtd    = document.getElementById('orderQuantidade').value.trim();
      const row    = findRowIndexForModel(modelo);
      orderItems.push({ rowIndex: row, modeloDigitado: modelo, quantidade: qtd });
      atualizarListaPedidos();
      duplicateIndex = -1;
      duplicateGroup = [];
    }

    /* 6) findRowIndexForModel */
    function findRowIndexForModel(input) {
      return data.findIndex(row => row.includes(input.toUpperCase()));
    }
function debugLog(msg) {
  const log = document.getElementById('debugLog');
  if (log) {
    log.innerText += msg + '\n';
  } else {
    console.log(msg);
  }
}

function blinkAndFocus(el) {
      el.classList.add('animate-blink');
      el.focus();
      // depois de 1,5s remove a classe
      setTimeout(() => el.classList.remove('animate-blink'), 1500);
    }

 /* 7) ADICIONAR PEDIDO */
   function adicionarPedido() {
  const modeloInput = document.getElementById('orderModelo');
  const qtdInput    = document.getElementById('orderQuantidade');
  const modelo      = modeloInput.value.trim();
  const quantidade  = qtdInput.value.trim();

  // Valida√ß√£o b√°sica
  if (!modelo || !quantidade) {
    alert("Preencha o modelo e a quantidade antes de adicionar!");
    if (!modelo)      blinkAndFocus(modeloInput);
    else if (!quantidade) blinkAndFocus(qtdInput);
    return;
  }

  // Encontra √≠ndice na tabela
  const rowIndex       = findRowIndexForModel(modelo);
  const modeloDigitado = modelo.toUpperCase();

  // Se n√£o existir na base, pergunta
  if (rowIndex === -1) {
    const confirma = confirm(
      `O modelo "${modeloDigitado}" n√£o est√° na base de compatibilidade.\n` +
      `Deseja adicionar mesmo assim?`
    );
    if (!confirma) {
      // se cancelar, pisca o input de modelo e sai
      blinkAndFocus(modeloInput);
      return;
    }
    // Se confirmou, adiciona direto e encerra
    orderItems.push({ rowIndex, modeloDigitado, quantidade });
    atualizarListaPedidos();
    return;
  }

  // Checa duplicatas
  duplicateGroup = orderItems
    .map((item, idx) => item.rowIndex === rowIndex ? idx : -1)
    .filter(idx => idx !== -1);

  if (duplicateGroup.length > 0) {
    document.getElementById('duplicateMessage').innerText =
      `O modelo "${modeloDigitado}" j√° foi adicionado. O que deseja fazer?`;
    document.getElementById('modalDuplicate').classList.remove('hidden');
  } else {
    // Caso normal: adiciona e atualiza lista
    orderItems.push({ rowIndex, modeloDigitado, quantidade });
    atualizarListaPedidos();
  }
}



    /* 8) Atualizar lista de pedidos */
function atualizarListaPedidos() {
  const pedidoItensDiv = document.getElementById('pedidoItens');
  if (orderItems.length === 0) {
    pedidoItensDiv.innerHTML = "<p class='text-gray-300'>Nenhum item adicionado ainda.</p>";
    return;
  }

  // 1) Empacota cada item com seu √≠ndice original
  const itemsWithIdx = orderItems
    .map((item, idx) => ({
      modelo: item.modeloDigitado.toUpperCase(),
      quantidade: item.quantidade,
      idx
    }))
    // 2) Ordena pelo modelo
    .sort((a, b) => a.modelo.localeCompare(b.modelo));

  // 3) Renderiza em lista
  let html = "<ul class='list-disc ml-5 space-y-1'>";
  itemsWithIdx.forEach(({ modelo, quantidade, idx }) => {
    html += `
      <li id="pedidoItem-${idx}" class="flex items-center gap-2">
        <span class="text-yellow-300 font-bold">${modelo}</span>
        <span class="text-white">‚Äì <strong>QTD:</strong> ${String(quantidade).padStart(2,'0')}</span>
        <button onclick="removerItemPedido(${idx})" class="bg-red-600 hover:bg-red-700 text-white ml-3 px-2 rounded text-xs">
          Remover
        </button>
        <button onclick="exibirInputEdicao(${idx})" class="bg-blue-600 hover:bg-blue-700 text-white ml-2 px-2 rounded text-xs">
          Alterar Qtde
        </button>
        <input type="number" id="editInput-${idx}" class="hidden w-16 p-1 text-black rounded text-xs ml-2"
               value="${quantidade}" min="1"
               onkeydown="if(event.key==='Enter'){salvarNovaQuantidade(${idx})}">
        <button id="saveBtn-${idx}" class="hidden bg-green-500 hover:bg-green-600 text-white px-2 rounded text-xs ml-1"
                onclick="salvarNovaQuantidade(${idx})">
          OK
        </button>
      </li>`;
  });
  html += "</ul>";

  pedidoItensDiv.innerHTML = html;
}

    /* 9) Edi√ß√£o e remo√ß√£o de itens */
    function exibirInputEdicao(index) {
      const inputQtd = document.getElementById(`editInput-${index}`);
      const saveBtn = document.getElementById(`saveBtn-${index}`);
      if (!inputQtd || !saveBtn) return;
      inputQtd.classList.remove('hidden');
      saveBtn.classList.remove('hidden');
      inputQtd.focus();
    }
    function salvarNovaQuantidade(index) {
      const inputQtd = document.getElementById(`editInput-${index}`);
      if (!inputQtd) return;
      const novaQtd = inputQtd.value.trim();
      if (!novaQtd || parseInt(novaQtd) < 1) {
        alert("Quantidade inv√°lida!");
        return;
      }
      orderItems[index].quantidade = novaQtd;
      atualizarListaPedidos();
    }
    function destacarItemNoPedido(index) {
      const li = document.getElementById(`pedidoItem-${index}`);
      if (!li) return;
      li.classList.add('bg-red-500');
      setTimeout(() => { li.classList.remove('bg-red-500'); }, 1000);
    }
    function removerItemPedido(index) {
      orderItems.splice(index, 1);
      atualizarListaPedidos();
    }

    /* 10) Modal de Duplicata */
    function cancelarDuplicado() {
      document.getElementById('modalDuplicate').classList.add('hidden');
      duplicateIndex = -1;
    }
function alterarQtdDuplicado() {
  document.getElementById('modalDuplicate').classList.add('hidden');
  if (duplicateGroup.length === 0) return;
  // destaca cada item duplicado
  duplicateGroup.forEach(idx => destacarItemNoPedido(idx));
  // opcional: j√° abre edi√ß√£o no primeiro
  exibirInputEdicao(duplicateGroup[0]);
  // limpa o array
  duplicateGroup = [];
}



/* 11) Gerar PDF do Pedido (com pagina√ß√£o autom√°tica) */
function gerarPDFPedido() {
  if (orderItems.length === 0) {
    alert("Nenhum item no pedido para gerar PDF!");
    return;
  }

  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  // Configura√ß√µes de pagina√ß√£o (mesmo c√≥digo de antes)‚Ä¶
  const pageHeight = doc.internal.pageSize.getHeight();
  const marginTop = 20;
  const marginBottom = 20;
  const lineHeight = 10;
  const leftMargin = 20;
  let offsetY = marginTop;

  function drawHeader() {
    doc.setFont("helvetica", "bold");
    doc.setFontSize(18);
    doc.text("Pedido de Pel√≠culas", leftMargin, offsetY);
    offsetY += lineHeight;
    doc.setFont("helvetica", "normal");
    doc.setFontSize(12);
  }

  drawHeader();

  orderItems.forEach((item, i) => {
    if (offsetY + marginBottom > pageHeight) {
      doc.addPage();
      offsetY = marginTop;
      drawHeader();
    }
    const text = `${i + 1}. Modelo: ${item.modeloDigitado.toUpperCase()} | Qtd: ${item.quantidade}`;
    doc.text(text, leftMargin, offsetY);
    offsetY += lineHeight;
  });

  if (offsetY + lineHeight + marginBottom > pageHeight) {
    doc.addPage();
    offsetY = marginTop;
  }
  offsetY += lineHeight;
  doc.text("Pedido gerado pelo site www.peliculasuti.com.br", leftMargin, offsetY);

  // Gera o PDF
  doc.save("pedido-peliculas.pdf");

  // AQUI: pergunta antes de limpar
  const desejaLimpar = confirm(
    "PDF gerado com sucesso!\n\n" +
    "*Clique em OK se tem CERTEZA que est√° tudo correto (PDF SER√Å GERADO) ap√≥s seus itens apagados.\n" +

    "*Clique em Cancelar para manter os itens e continuar editando mesmo ap√≥s gerar o PDF (PDF SER√Å GERADO)."
  );

  if (desejaLimpar) {
    orderItems = [];
    atualizarListaPedidos();
    deleteDraft();
  }
}


// 12) Fun√ß√£o que faz o upsert em Supabase
async function salvarDraft() {
  const email = localStorage.getItem("user_email");
  if (!email) return alert("Voc√™ precisa estar logado para salvar o pedido.");

  // converte orderItems para JSON simples
  const payload = orderItems.map(i => ({
    modelo:     i.modeloDigitado,
    quantidade: i.quantidade,
    rowIndex:   i.rowIndex
  }));
  try {
    const res = await fetch(`${supabaseUrl}/rest/v1/draft_orders`, {
      method:  "POST",
      headers: {
        apikey:        supabaseKey,
        Authorization: `Bearer ${supabaseKey}`,
        "Content-Type":  "application/json",
        Prefer:          "resolution=merge-duplicates"
      },
      body: JSON.stringify([{ email, items: payload }])
    });
    if (!res.ok) throw await res.text();
    alert("‚úÖ Pedido salvo com sucesso!");
  } catch (err) {
    console.error(err);
    alert("‚ùå Falha ao salvar o pedido: " + err);
  }
}

// ‚îÄ‚îÄ‚îÄ Registra o listener UMA √öNICA VEZ, fora da fun√ß√£o ‚îÄ‚îÄ‚îÄ
document
  .getElementById("btnSalvarPedido")
  .addEventListener("click", salvarDraft);



    /* 12) LOGIN / LOGOUT */
    async function checkEmail() {
      const email = document.getElementById('email').value.trim().toLowerCase();
      const rememberEmailChecked = document.getElementById('rememberEmail').checked;
      if (rememberEmailChecked && email) localStorage.setItem('saved_email', email);
      else localStorage.removeItem('saved_email');
      if (!email) {
        alert('Digite um e‚Äëmail v√°lido.');
        return;
      }

      try {
        const resSessoes = await fetch(`${supabaseUrl}/rest/v1/sessoes?email=eq.${email}`, {
          method: "GET",
          headers: {
            apikey: supabaseKey,
            Authorization: `Bearer ${supabaseKey}`,
            "Content-Type": "application/json",
            "Accept": "application/json"
          }
        });
        const autorizacoes = await resSessoes.json();
        if (!autorizacoes || autorizacoes.length === 0) {
          alert("E‚Äëmail n√£o autorizado. Por favor, adquira o plano para acessar.");
          return;
        }
        const registro = autorizacoes[0];
        const hoje = new Date();
        const expira = new Date(registro.data_expiracao);
       if (hoje > expira) {
  if (confirm(`Seu plano ${registro.plano} expirou em ${formatarData(registro.data_expiracao)}.\nClique em OK para ver nossos planos.`)) {
    mostrarPlanos();
    window.location.hash = '#planosSection';
  }
  return;
}




       // PEGA O IP E DEVICE INFO
const ipResp = await fetch('https://api.ipify.org?format=json');
const ipData = await ipResp.json();
const ipAddress = ipData.ip;
const deviceInfo = navigator.userAgent;

// Gera ou recupera um device_id √∫nico salvo no navegador
let deviceId = localStorage.getItem('device_id');
if (!deviceId) {
  deviceId = generateToken(); // Usa sua fun√ß√£o existente
  localStorage.setItem('device_id', deviceId);
}

// BUSCA TODAS AS SESS√ïES ATIVAS DESTE USU√ÅRIO
// 1. Busca o valor de max_devices para este usu√°rio (tabela usuarios ou clientes)
const userRes = await fetch(`${supabaseUrl}/rest/v1/usuarios?email=eq.${email}`, {
  headers: {
    apikey: supabaseKey,
    Authorization: `Bearer ${supabaseKey}`,
    "Content-Type": "application/json"
  }
});
const usuarios = await userRes.json();
const maxDevices = (usuarios.length && usuarios[0].max_devices) ? usuarios[0].max_devices : 2; // padr√£o 2, se n√£o achar

// 2. Busca sess√µes ativas desse usu√°rio
const resDevices = await fetch(`${supabaseUrl}/rest/v1/login_sessions?email=eq.${email}&ativa=eq.true`, {
  headers: {
    apikey: supabaseKey,
    Authorization: `Bearer ${supabaseKey}`,
    "Content-Type": "application/json"
  }
});
const activeSessions = await resDevices.json();

const deviceAlreadyLogged = activeSessions.some(sess => sess.device_id === deviceId);

// 3. Usa o maxDevices da tabela para liberar ou bloquear
if (deviceAlreadyLogged || activeSessions.length < maxDevices) {
  // Libera login normalmente (segue fluxo original, insere nova sess√£o)
  // ... segue o c√≥digo normal de cria√ß√£o de sess√£o
} else {
  // BLOQUEIA: limite de dispositivos diferentes atingido
alert(`Voc√™ j√° atingiu o limite de ${maxDevices} dispositivos diferentes cadastrados neste plano. Para liberar acesso a mais dispositivos, adquira um novo plano utilizando outro e-mail.`);

  return;
}

// No momento de inserir a sess√£o, inclua device_id:
const sessionToken = generateToken();
const novaSessao = {
  email: email,
  session_token: sessionToken,
  ativa: true,
  login_date: getBrasiliaISOString(), // <- Agora salva em hor√°rio de Bras√≠lia!
  device_info: deviceInfo,
  ip_address: ipAddress,
  device_id: deviceId
};

const resInsert = await fetch(`${supabaseUrl}/rest/v1/login_sessions`, {
  method: "POST",
  headers: {
    apikey: supabaseKey,
    Authorization: `Bearer ${supabaseKey}`,
    "Content-Type": "application/json"
  },
  body: JSON.stringify(novaSessao)
});
if (!resInsert.ok) {
  console.error("Erro ao criar a nova sess√£o:", resInsert.statusText);
  alert("Erro ao criar sess√£o. Tente novamente.");
  return;
}


              // ‚Ä¶ ap√≥s salvar no localStorage ‚Ä¶
localStorage.setItem("user_email", email);
localStorage.setItem("login_date", new Date().toISOString());
localStorage.setItem("session_token", sessionToken);

// 1) Oculta todas as se√ß√µes que n√£o s√£o a busca
['introSection','promoPedido','planosSection','loginArea','orderSection']
  .forEach(id => {
    const el = document.getElementById(id);
    if (!el) return;
    el.classList.add('hidden');
    el.style.display = 'none';
  });

// 2) Exibe corretamente a √°rea de busca
const busca = document.getElementById('searchSection');
busca.classList.remove('hidden');
busca.style.display = '';             // limpa qualquer inline que escondia
busca.scrollIntoView({                // rola at√© o campo de pesquisa
  behavior: 'smooth',
  block: 'start'
});


// Aqui voc√™ d√° o foco no campo de digita√ß√£o
const inputBusca = document.getElementById('searchModel');
if (inputBusca) inputBusca.focus();

// Ajusta o menu e a mensagem de boas‚Äëvindas
document.querySelector('a[href="#introSection"]').style.display = 'none';
document.querySelector('a[href="#planosSection"]').style.display = 'none';
document.getElementById('menuLogin').innerText = 'Sair';
document.getElementById('menuLogin').setAttribute('onclick', 'logout()');
document.querySelector("#searchSection .bg-gray-800").innerHTML =
  `<strong>Bem-vindo(a), ${registro.nome}!</strong><br>` +
  `Plano: ${registro.plano}<br>` +
  `V√°lido at√©: ${formatarData(registro.data_expiracao)}`;

// Carrega os dados para pesquisa
loadData();
// busca draft existente
const draftRes = await fetch(
  `${supabaseUrl}/rest/v1/draft_orders?email=eq.${email}`,
  { headers: { apikey: supabaseKey, Authorization: `Bearer ${supabaseKey}` } }
);
const [draft] = await draftRes.json();
if (draft && Array.isArray(draft.items)) {
  // converte o JSON de volta para orderItems
  orderItems = draft.items.map(i => ({
    rowIndex: i.rowIndex,
    modeloDigitado: i.modelo,
    quantidade: i.quantidade
  }));
  atualizarListaPedidos();
}


      } catch (err) {
        console.error(err);
        alert("‚ùå Ocorreu um erro ao verificar o e‚Äëmail.");
      }
    }

    async function logout() {
      const email = localStorage.getItem("user_email");
      const sessionToken = localStorage.getItem("session_token");
      if (!email || !sessionToken) return;
      const supabaseUrl = "https://chjdjfycylqhxtfrbdxm.supabase.co";
      const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNoamRqZnljeWxxaHh0ZnJiZHhtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDIxNTg0MTYsImV4cCI6MjA1NzczNDQxNn0.GvMeSnBDF0CS9-uampycS-C4qqfMgTzSsjYGqHrOFXU";
      try {
        await fetch(`${supabaseUrl}/rest/v1/login_sessions?session_token=eq.${sessionToken}`, {
          method: "PATCH",
          headers: {
            apikey: supabaseKey,
            Authorization: `Bearer ${supabaseKey}`,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ ativa: false })
        });
      } catch (err) {
        console.error("Erro ao encerrar a sess√£o:", err);
      }
      localStorage.removeItem("user_email");
      localStorage.removeItem("login_date");
      localStorage.removeItem("session_token");
      document.querySelector('a[href="#introSection"]').style.display = '';
      document.querySelector('a[href="#planosSection"]').style.display = '';
      document.getElementById('introSection').style.display = 'block';
      document.getElementById('planosSection').classList.remove('hidden');
      document.getElementById('loginArea').classList.add('hidden');
      document.getElementById('searchSection').classList.add('hidden');
      document.getElementById('orderSection').classList.add('hidden');
      document.getElementById('menuLogin').innerText = 'Login';
      document.getElementById('menuLogin').setAttribute('onclick', 'goToLogin()');
    }

    async function validateSession() {
      const email = localStorage.getItem("user_email");
      const storedToken = localStorage.getItem("session_token");
      if (!email || !storedToken) return;
      const supabaseUrl = "https://chjdjfycylqhxtfrbdxm.supabase.co";
      const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNoamRqZnljeWxxaHh0ZnJiZHhtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDIxNTg0MTYsImV4cCI6MjA1NzczNDQxNn0.GvMeSnBDF0CS9-uampycS-C4qqfMgTzSsjYGqHrOFXU";
      try {
        const res = await fetch(`${supabaseUrl}/rest/v1/login_sessions?email=eq.${email}&session_token=eq.${storedToken}`, {
          headers: {
            apikey: supabaseKey,
            Authorization: `Bearer ${supabaseKey}`,
            "Content-Type": "application/json"
          }
        });
        const result = await res.json();
        if (!result || result.length === 0 || result[0].ativa !== true) {
          console.warn("Sess√£o inv√°lida ou n√£o encontrada; ignorando logout imediato.");
        }
      } catch (err) {
        console.error("Erro na valida√ß√£o da sess√£o:", err);
      }
    }
    setInterval(validateSession, 60000);

    window.addEventListener("beforeunload", async () => {
      const sessionToken = localStorage.getItem("session_token");
      if (!sessionToken) return;
      const supabaseUrl = "https://chjdjfycylqhxtfrbdxm.supabase.co";
      const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNoamRqZnljeWxxaHh0ZnJiZHhtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDIxNTg0MTYsImV4cCI6MjA1NzczNDQxNn0.GvMeSnBDF0CS9-uampycS-C4qqfMgTzSsjYGqHrOFXU";
      try {
        await fetch(`${supabaseUrl}/rest/v1/login_sessions?session_token=eq.${sessionToken}`, {
          method: "PATCH",
          headers: {
            apikey: supabaseKey,
            Authorization: `Bearer ${supabaseKey}`,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ ativa: false })
        });
      } catch (err) {
        console.error("Erro no beforeunload:", err);
      }
    });

    /** 13) Exibir/Ocultar Se√ß√µes */
function mostrarInicio() {
  // 1) Esconder apenas as √°reas restritas / p√≥s-login
  ['loginArea','searchSection','orderSection']
    .forEach(id => {
      const el = document.getElementById(id);
      if (!el) return;
      el.classList.add('hidden');
      el.style.display = 'none';
    });

  // 2) Mostrar completa a home: intro + promo + planos
  ['introSection','promoPedido','planosSection']
    .forEach(id => {
      const el = document.getElementById(id);
      if (!el) return;
      el.classList.remove('hidden');
      el.style.display = '';
    });

  // 3) Rolar suavemente at√© o topo da intro
  document.getElementById('introSection')
          .scrollIntoView({ behavior: 'smooth', block: 'start' });
}


    function mostrarPlanos() {
  // Esconde tudo, usando classes e inline
  ['introSection','promoPedido','loginArea','searchSection','orderSection']
    .forEach(id => {
      const el = document.getElementById(id);
      el.classList.add('hidden');
      el.style.display = 'none';
    });

  // Mostra a se√ß√£o de Planos
  const planos = document.getElementById('planosSection');
  planos.classList.remove('hidden');
  planos.style.display = '';        // limpa o display inline
  planos.scrollIntoView({ behavior: 'smooth' });
}

    function goToLogin() {
  // 1) Esconder todas as se√ß√µes da home e p√≥s-login
  ['introSection','promoPedido','planosSection','searchSection','orderSection']
    .forEach(id => {
      const el = document.getElementById(id);
      if (!el) return;
      // oculta via classe e inline
      el.classList.add('hidden');
      el.style.display = 'none';
    });

  // 2) Mostrar apenas o formul√°rio de login
  const login = document.getElementById('loginArea');
  login.classList.remove('hidden');
  login.style.display = '';             // limpa qualquer inline que escondia
  login.scrollIntoView({                // rola at√© o login
    behavior: 'smooth',
    block: 'start'
  });
}


function logout() {
  // 1) Esconder as √°reas restritas
  ['loginArea','searchSection','orderSection']
    .forEach(id => document.getElementById(id).classList.add('hidden'));

  // 2) Exibir Intro, PromoPedido e Planos
  const intro = document.getElementById('introSection');
  const promo = document.getElementById('promoPedido');
  const planos = document.getElementById('planosSection');

  // Remove a classe hidden
  [intro, promo, planos].forEach(el => el.classList.remove('hidden'));
  // Limpa qualquer inline style que estava escondendo
  [intro, promo, planos].forEach(el => el.style.display = '');

  // 2.1) Reexibir links de navega√ß√£o
  const linkInicio = document.querySelector('a[href="#introSection"]');
  const linkPlanos = document.querySelector('a[href="#planosSection"]');
  if (linkInicio) linkInicio.style.display = '';
  if (linkPlanos) linkPlanos.style.display = '';

  // 3) Rolar at√© o in√≠cio
  intro.scrollIntoView({ behavior: 'smooth', block: 'start' });

  // 4) Resetar o menu para ‚ÄúLogin‚Äù
  const btn = document.getElementById('menuLogin');
  btn.innerText = 'Login';
  btn.onclick = goToLogin;

  // 5) Limpar credenciais (opcional)
  localStorage.removeItem('user_email');
  localStorage.removeItem('session_token');
}

function mostrarPedidos() {
  // 1) Esconde todas as se√ß√µes anteriores (classe e inline)
  ['introSection','planosSection','loginArea','searchSection'].forEach(id => {
    const el = document.getElementById(id);
    if (!el) return;
    el.classList.add('hidden');
    el.style.display = 'none';
  });

  // 2) Exibe a √°rea de pedido (removendo hidden e inline display)
  const order = document.getElementById('orderSection');
  order.classList.remove('hidden');
  order.style.display = '';             // limpa qualquer display:none inline
  order.scrollIntoView({                // rola at√© a se√ß√£o (opcional)
    behavior: 'smooth',
    block: 'start'
  });

  // 3) Pr√©-preenche o modelo buscado (se houver)
  const modeloPesquisado = document.getElementById('searchModel').value.trim();
  if (modeloPesquisado) {
    document.getElementById('orderModelo').value = modeloPesquisado;
  }

  // 4) Foca no input de modelo para digitar a quantidade
  document.getElementById('orderModelo')?.focus();
}




// 17) Voltar √† consulta de modelos mantendo o pedido atual
function voltarConsulta() {
  // 1) Esconde a se√ß√£o de pedidos (classe + inline)
  const order = document.getElementById('orderSection');
  order.classList.add('hidden');
  order.style.display = 'none';

  // 2) Exibe a se√ß√£o de busca (remove hidden + limpa inline)
  const search = document.getElementById('searchSection');
  search.classList.remove('hidden');
  search.style.display = '';
  search.scrollIntoView({              // opcional: rola at√© a busca
    behavior: 'smooth',
    block: 'start'
  });

  // 3) Foca no campo de busca
  document.getElementById('searchModel')?.focus();
}


// 1) Fun√ß√£o auxiliar para apagar o draft do Supabase
async function deleteDraft() {
  const email = localStorage.getItem("user_email");
  if (!email) return;
  try {
    const res = await fetch(
      `${supabaseUrl}/rest/v1/draft_orders?email=eq.${email}`,
      {
        method: "DELETE",
        headers: {
          apikey:        supabaseKey,
          Authorization: `Bearer ${supabaseKey}`
        }
      }
    );
    if (!res.ok) throw await res.text();
  } catch (err) {
    console.error("Erro ao deletar rascunho:", err);
  }
}
// 2) Limpar pedido local **e** no Supabase
function limparPedido() {
  orderItems = [];
  atualizarListaPedidos();
  deleteDraft();            // ‚Üê apaga o rascunho remoto
}

    /* 14) Se√ß√µes Legais */
    function mostrarLegal(secId) {
      document.getElementById('legalContentContainer').classList.remove('hidden');
      document.querySelectorAll('.legal-section').forEach(sec => sec.classList.add('hidden'));
      document.getElementById(secId).classList.remove('hidden');
      document.getElementById('legalContentContainer').scrollIntoView({ behavior: 'smooth' });
    }
    function fecharLegal() {
      document.getElementById('legalContentContainer').classList.add('hidden');
    }

    /* 15) Modais: Incompatibilidade e Compatibilidade */
    function abrirModalIncompatibilidade() {
      const modeloProcurado = document.getElementById('searchModel').value.trim();
      if (modeloProcurado) {
        document.getElementById('modeloTestado').value = modeloProcurado;
      }
      document.getElementById('modalIncompatibilidade').classList.remove('hidden');
    }
    function fecharModalIncompatibilidade() {
      document.getElementById('modalIncompatibilidade').classList.add('hidden');
    }
    async function enviarIncompatibilidade() {
  const supabaseUrl = "https://chjdjfycylqhxtfrbdxm.supabase.co";
  const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNoamRqZnljeWxxaHh0ZnJiZHhtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDIxNTg0MTYsImV4cCI6MjA1NzczNDQxNn0.GvMeSnBDF0CS9-uampycS-C4qqfMgTzSsjYGqHrOFXU";
  const modeloTestado = document.getElementById('modeloTestado').value.trim();
  const modeloIncompativel = document.getElementById('modeloIncompativel').value.trim();
  const email = localStorage.getItem("user_email") || null;

  if (!modeloTestado || !modeloIncompativel) {
    return alert("Preencha ambos os campos antes de enviar!");
  }

  try {
    const res = await fetch(`${supabaseUrl}/rest/v1/relatorios_pelicula`, {
      method: "POST",
      headers: {
        apikey: supabaseKey,
        Authorization: `Bearer ${supabaseKey}`,
        "Content-Type": "application/json"
      },
      body: JSON.stringify([{
        tipo: "incompatibilidade",
        modelo_procurado: modeloTestado,
        modelo_informado: modeloIncompativel,
        email_usuario: email
      }])
    });

    if (!res.ok) throw new Error(await res.text());

    alert("üì• Registro de incompatibilidade enviado com sucesso!");
    fecharModalIncompatibilidade();
  } catch (err) {
    console.error(err);
    alert("‚ùå Falha ao enviar. Tente novamente.");
  }
}

    function abrirModalCompatibilidade() {
      const modeloProcurado = document.getElementById('searchModel').value.trim();
      if (modeloProcurado) {
        document.getElementById('modeloProcuradoCompat').value = modeloProcurado;
      }
      document.getElementById('modalCompatibilidade').classList.remove('hidden');
    }
    function fecharModalCompatibilidade() {
      document.getElementById('modalCompatibilidade').classList.add('hidden');
    }
    async function enviarCompatibilidade() {
  const supabaseUrl = "https://chjdjfycylqhxtfrbdxm.supabase.co";
  const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNoamRqZnljeWxxaHh0ZnJiZHhtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDIxNTg0MTYsImV4cCI6MjA1NzczNDQxNn0.GvMeSnBDF0CS9-uampycS-C4qqfMgTzSsjYGqHrOFXU";
  const modeloProcurado = document.getElementById('modeloProcuradoCompat').value.trim();
  const modeloCompativel = document.getElementById('modeloCompativel').value.trim();
  const email = localStorage.getItem("user_email") || null;

  if (!modeloProcurado || !modeloCompativel) {
    return alert("Preencha ambos os campos antes de enviar!");
  }

  try {
    const res = await fetch(`${supabaseUrl}/rest/v1/relatorios_pelicula`, {
      method: "POST",
      headers: {
        apikey: supabaseKey,
        Authorization: `Bearer ${supabaseKey}`,
        "Content-Type": "application/json"
      },
      body: JSON.stringify([{
        tipo: "compatibilidade",
        modelo_procurado: modeloProcurado,
        modelo_informado: modeloCompativel,
        email_usuario: email
      }])
    });

    if (!res.ok) throw new Error(await res.text());

    alert("üì• Registro de compatibilidade enviado com sucesso!");
    fecharModalCompatibilidade();
  } catch (err) {
    console.error(err);
    alert("‚ùå Falha ao enviar. Tente novamente.");
  }
}




    /* --------------------- FIM --------------------- */
  </script>
</body>
</html>
