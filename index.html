<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pel√≠cula Compat√≠vel</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      background-color: #111;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      color: white;
    }
    .badge {
      background-color: #e11d48;
      color: white;
      font-size: 0.75rem;
      padding: 0.25rem 0.75rem;
      border-radius: 9999px;
      font-weight: bold;
    }
    .highlight {
      animation: pulse 1.5s infinite;
    }
    @keyframes pulse {
      0%, 100% { box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.4); }
      50% { box-shadow: 0 0 0 10px rgba(255, 255, 255, 0); }
    }
  </style>
  <script>
    // BLOQUEIO DO CLIQUE COM BOT√ÉO DIREITO E TECLAS DE ATALHO
    document.addEventListener('contextmenu', function(e) {
      e.preventDefault();
    });
    document.addEventListener('keydown', function(e) {
      if (e.keyCode === 123 || 
         (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J')) ||
         (e.ctrlKey && e.key === 'U')) {
        e.preventDefault();
      }
    });
  </script>
</head>
<body>
  <!-- Cabe√ßalho -->
  <header class="bg-gradient-to-r from-[#0f172a] to-[#1e3a8a] p-6 shadow-md text-white">
    <div class="max-w-6xl mx-auto flex justify-between items-center">
      <h1 class="text-3xl font-extrabold tracking-wide">PEL√çCULA COMPAT√çVEL</h1>
      <nav class="space-x-6 text-sm font-semibold">
        <a href="#introSection" id="menuPlanos" onclick="mostrarInicio()" class="hover:text-yellow-400 transition">Planos</a>
        <a href="https://wa.me/utidatecnologia" target="_blank" class="hover:text-yellow-400 transition">Contato</a>
        <a href="#loginArea" id="menuLogin" onclick="goToLogin()" class="hover:text-yellow-400 transition">Login</a>
      </nav>
    </div>
  </header>

  <!-- Introdu√ß√£o -->
  <section id="introSection" class="py-12 bg-[#0b1120] text-white">
    <div class="max-w-7xl mx-auto flex flex-col-reverse lg:flex-row items-center px-4 lg:px-8">
      <!-- Texto -->
      <div class="lg:w-1/2 text-center lg:text-left">
        <h2 class="text-3xl sm:text-4xl font-extrabold text-yellow-400 mb-4">
          <span class="inline-block">üß©</span> Encontre a pel√≠cula certa em segundos
        </h2>
        <p class="text-gray-300 text-lg mb-4">
          Voc√™ trabalha com celular e perde tempo testando pel√≠culas ou pesquisando compatibilidades?<br>
          <span class="font-bold text-white">Esse site √© pra voc√™.</span>
        </p>
        <p class="text-gray-400 mb-4">
          Aqui voc√™ acessa uma <span class="text-yellow-400 font-bold">tabela completa e atualizada</span> com modelos compat√≠veis.<br>
          Economize tempo, evite erros e <span class="text-yellow-400 font-bold">venda mais com seguran√ßa</span>.
        </p>
        <div class="flex flex-wrap justify-center lg:justify-start gap-3 mt-4">
          <span class="bg-green-600 text-white px-4 py-1 rounded-full text-sm">‚úîÔ∏è F√°cil de usar</span>
          <span class="bg-green-600 text-white px-4 py-1 rounded-full text-sm">‚úîÔ∏è Sem propagandas</span>
          <span class="bg-green-600 text-white px-4 py-1 rounded-full text-sm">‚úîÔ∏è Atualiza√ß√µes autom√°ticas</span>
        </div>
        <p class="text-white mt-6 text-lg">
          <span class="text-yellow-400 font-bold">A partir de R$ 12,00 por m√™s</span>, voc√™ transforma seu atendimento e ganha confian√ßa no que oferece.
        </p>
      </div>
      <!-- Imagem -->
      <div class="lg:w-1/2 flex justify-center mb-8 lg:mb-0">
        <img src="pelicua3d.png" alt="Pel√≠culas 3D" class="max-w-xs sm:max-w-sm md:max-w-md lg:max-w-sm xl:max-w-md">
      </div>
    </div>
  </section>

  <!-- T√≠tulo dos Planos -->
  <section class="text-center py-12 bg-[#121212]">
    <h2 class="text-4xl font-extrabold text-yellow-400">Escolha seu Plano</h2>
    <p class="text-gray-300 mt-2">Acesse nossa tabela de pel√≠culas compat√≠veis com desconto progressivo.</p>
  </section>

  <!-- Planos -->
  <section id="planosSection" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 px-4 sm:px-8 py-8 max-w-7xl mx-auto">
    <!-- 1 M√äS -->
    <div class="relative bg-white text-black rounded-xl p-6 text-center shadow-md flex flex-col justify-between">
      <div>
        <div class="badge bg-gray-300 text-gray-800 absolute top-2 right-2">0% OFF</div>
        <h3 class="text-lg sm:text-xl font-bold">1 M√™s</h3>
        <p class="text-3xl sm:text-4xl font-extrabold mt-2">R$ 16,00</p>
        <p class="text-sm text-gray-600 mb-3">Total: R$ 16,00</p>
        <ul class="text-sm sm:text-base mb-6 text-left space-y-1">
          <li>üìÑ Acesso √† tabela completa</li>
          <li>üîÑ Atualiza√ß√µes autom√°ticas</li>
          <li>üö´ Sem propagandas</li>
        </ul>
      </div>
      <button onclick="window.open('https://mpago.la/1CFqLVk', '_blank')" class="w-full bg-black text-white py-3 rounded-lg font-semibold hover:opacity-80 transition text-sm sm:text-base">
        üí≥ Comprar
      </button>
    </div>

    <!-- 3 MESES -->
    <div class="relative bg-[#fffbea] text-black rounded-xl p-6 text-center shadow-[0_0_25px_rgba(255,204,0,0.5)] border-2 border-yellow-400 highlight">
      <div class="absolute -top-4 left-1/2 transform -translate-x-1/2 bg-yellow-400 text-black px-3 py-1 rounded-full text-xs font-bold shadow-lg">
        MAIS VENDIDO
      </div>
      <h3 class="text-xl font-bold flex justify-center items-center gap-2">‚≠ê 3 Meses</h3>
      <p class="text-3xl font-extrabold mt-2">R$ 14,00</p>
      <p class="text-sm text-gray-600 mb-3">Total: R$ 42,00</p>
      <ul class="text-sm sm:text-base mb-4 text-left space-y-1">
        <li>üìÑ Acesso √† tabela completa</li>
        <li>üîÑ Atualiza√ß√µes autom√°ticas</li>
        <li>üö´ Sem propagandas</li>
      </ul>
      <button onclick="window.open('https://mpago.la/1DTP1fB', '_blank')" class="w-full bg-black text-white py-3 rounded-lg font-semibold hover:opacity-80 transition text-sm sm:text-base">
        üí≥ Comprar
      </button>
    </div>

    <!-- 6 MESES -->
    <div class="relative bg-white text-black rounded-xl p-6 text-center shadow-md flex flex-col justify-between">
      <div>
        <div class="badge absolute top-2 right-2">18,75% OFF</div>
        <h3 class="text-lg sm:text-xl font-bold">6 Meses</h3>
        <p class="text-3xl sm:text-4xl font-extrabold mt-2">R$ 13,00</p>
        <p class="text-sm text-gray-600 mb-3">Total: R$ 78,00</p>
        <ul class="text-sm sm:text-base mb-6 text-left space-y-1">
          <li>üìÑ Acesso √† tabela completa</li>
          <li>üîÑ Atualiza√ß√µes autom√°ticas</li>
          <li>üö´ Sem propagandas</li>
        </ul>
      </div>
      <button onclick="window.open('https://mpago.la/2yYjQtG', '_blank')" class="w-full bg-black text-white py-3 rounded-lg font-semibold hover:opacity-80 transition text-sm sm:text-base">
        üí≥ Comprar
      </button>
    </div>

    <!-- 1 ANO -->
    <div class="relative bg-white text-black rounded-xl p-6 text-center shadow-md flex flex-col justify-between">
      <div>
        <div class="badge absolute top-2 right-2">25% OFF</div>
        <h3 class="text-lg sm:text-xl font-bold">1 Ano</h3>
        <p class="text-3xl sm:text-4xl font-extrabold mt-2">R$ 12,00</p>
        <p class="text-sm text-gray-600 mb-3">Total: R$ 144,00</p>
        <ul class="text-sm sm:text-base mb-6 text-left space-y-1">
          <li>üìÑ Acesso √† tabela completa</li>
          <li>üîÑ Atualiza√ß√µes autom√°ticas</li>
          <li>üö´ Sem propagandas</li>
        </ul>
      </div>
      <button onclick="window.open('https://mpago.la/2e4ENYH', '_blank')" class="w-full bg-black text-white py-3 rounded-lg font-semibold hover:opacity-80 transition text-sm sm:text-base">
        üí≥ Comprar
      </button>
    </div>
  </section>

  <!-- √Årea de Login -->
  <section id="loginArea" class="max-w-4xl mx-auto p-4 sm:p-6 hidden">
    <label class="block mb-2 font-medium text-sm sm:text-base">Digite seu e-mail para acessar</label>
    <input type="email" id="email" placeholder="Digite seu e-mail" class="w-full p-3 text-black rounded-lg mb-4 text-sm sm:text-base"/>
    <button onclick="checkEmail()" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 rounded-lg transition text-sm sm:text-base">
      üîê Entrar
    </button>
  </section>

  <!-- √Årea de Busca -->
  <section id="searchSection" class="hidden max-w-4xl mx-auto mt-10 p-4">
    <div class="mb-4 bg-gray-800 text-center p-4 rounded-lg">
      <strong>Bem-vindo(a)!</strong> Agora voc√™ tem acesso ao buscador de pel√≠culas mais completo do Brasil!
    </div>
    <label class="block mb-2 text-sm font-medium">Digite o modelo do celular</label>
    <input type="text" id="searchModel" placeholder="Digite o modelo" class="w-full p-3 text-black rounded-lg mb-4"/>
    <div id="result" class="p-4 bg-gray-700 rounded-lg hidden font-semibold"></div>
    <button onclick="togglePlanos()" id="planosToggle" class="mt-6 w-full bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-2 rounded-lg hidden">
      üí≥ Ver Planos +
    </button>
  </section>

  <!-- Planos abaixo da Busca -->
  <section id="planosSectionAfter" class="hidden grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 sm:gap-6 px-4 sm:px-8 py-8 max-w-7xl mx-auto"></section>

  <!-- Rodap√© -->
  <footer class="text-center text-gray-400 text-sm py-8">
    Copyright &copy; 2021 UTI Da Tecnologia - Todos os Direitos Reservados.<br>
    Desenvolvido por <strong>Carla Vasconcelos</strong> (UTI Da Tecnologia).
  </footer>

  <script>
    let data = [];

    function formatarData(dataString) {
      const partes = dataString.split("-");
      if (partes.length === 3) {
        return `${partes[2]}/${partes[1]}/${partes[0]}`;
      }
      return dataString;
    }

    // Fun√ß√£o para carregar dados (ex: da planilha)
    function loadData() {
      fetch('https://script.google.com/macros/s/AKfycbwiDM-VA66hS8pnAGghwY2vxL3vqrRp9SIHmGc5AkwlMZeMYXg_An3dCvoJQUq6mJWTuA/exec')
        .then(response => response.json())
        .then(jsonData => {
          data = jsonData.map(row =>
            row[0].trim().toUpperCase().split(',').map(m => m.trim())
          );
        });
    }

    function searchModel() {
      const searchModel = document.getElementById('searchModel').value.toUpperCase().trim();
      const resultElement = document.getElementById('result');
      if (searchModel === "") {
        resultElement.classList.add('hidden');
        return;
      }
      let foundRows = data.flatMap(row =>
        row.some(model => model.includes(searchModel))
          ? [`Modelo Procurado: <strong>${searchModel}</strong><br>Modelos Compat√≠veis: ${row.map(m =>
              m.includes(searchModel) ? `<span class="highlight">${m}</span>` : m
            ).join(', ')}`]
          : []
      );
      resultElement.innerHTML = foundRows.length > 0 ? foundRows.join('<br><br>') : "<strong>Modelo n√£o encontrado</strong>";
      resultElement.classList.remove('hidden');
    }

    document.getElementById('searchModel').addEventListener('input', searchModel);

    // Fun√ß√£o para gerar um token de sess√£o √∫nico
    function generateToken() {
      return Date.now().toString() + Math.random().toString(36).substr(2, 8);
    }

    // Fun√ß√£o de Login (checkEmail) ‚Äì verifica√ß√£o de e-mail pago, controle de IP e exibi√ß√£o do primeiro nome
    async function checkEmail() {
      const email = document.getElementById('email').value.trim().toLowerCase();
      if (!email) {
        alert('Digite um e-mail v√°lido.');
        return;
      }

      const supabaseUrl = "https://chjdjfycylqhxtfrbdxm.supabase.co";
      const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNoamRqZnljeWxxaHh0ZnJiZHhtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDIxNTg0MTYsImV4cCI6MjA1NzczNDQxNn0.GvMeSnBDF0CS9-uampycS-C4qqfMgTzSsjYGqHrOFXU";

      try {
        // Verifica a tabela "sessoes" para confirmar que o e-mail foi cadastrado (plano pago)
        const resSessoes = await fetch(`${supabaseUrl}/rest/v1/sessoes?email=eq.${email}`, {
          method: "GET",
          headers: {
            apikey: supabaseKey,
            Authorization: `Bearer ${supabaseKey}`,
            "Content-Type": "application/json",
            "Accept": "application/json"
          }
        });
        const autorizacoes = await resSessoes.json();
        if (!autorizacoes || autorizacoes.length === 0) {
          alert("E-mail n√£o autorizado. Por favor, adquira o plano para acessar.");
          return;
        }
        // Verifica se o plano ainda est√° v√°lido
        const registro = autorizacoes[0];
        const hoje = new Date();
        const expira = new Date(registro.data_expiracao);
        if (hoje > expira) {
          alert("Seu plano expirou. Realize um novo pagamento para continuar o acesso.");
          return;
        }

        // Obt√©m o IP p√∫blico do usu√°rio utilizando a API ipify
        const ipResp = await fetch('https://api.ipify.org?format=json');
        const ipData = await ipResp.json();
        const ipAddress = ipData.ip;

        // Verifica se o campo allowed_ip est√° definido no registro da tabela "sessoes"
        if (!registro.allowed_ip) {
          // Primeiro acesso: define o allowed_ip como o ip atual
          await fetch(`${supabaseUrl}/rest/v1/sessoes?email=eq.${email}`, {
            method: "PATCH",
            headers: {
              apikey: supabaseKey,
              Authorization: `Bearer ${supabaseKey}`,
              "Content-Type": "application/json"
            },
            body: JSON.stringify({ allowed_ip: ipAddress })
          });
        } else if (registro.allowed_ip !== ipAddress) {
          // Se o IP atual for diferente do allowed_ip, bloqueia o acesso
          // Cria a mensagem do WhatsApp usando o primeiro nome e o e-mail
          let whatsappMsg = encodeURIComponent(`Ol√° meu nome √© ${registro.nome} e meu e-mail √© ${email}, gostaria de excluir o meu IP cadastrado anteriormente. Estou ciente que somente posso fazer essa altera√ß√£o uma √∫nica vez!`);
          alert("Seu acesso est√° restrito ao IP: " + registro.allowed_ip + ". Para solicitar a altera√ß√£o, clique no bot√£o.");
          document.getElementById('loginArea').innerHTML = '<p style="text-align:center; margin-top:20px;"><a href="https://wa.me/5537999625138?text=' + whatsappMsg + '" target="_blank" style="background:#25D366; padding:10px 20px; border-radius:5px; color:#fff; text-decoration:none;">Solicitar Exclus√£o de IP</a></p>';
          return;
        }

        // Consulta a tabela "login_sessions" para obter as sess√µes ativas para o mesmo e-mail
        const resSessions = await fetch(`${supabaseUrl}/rest/v1/login_sessions?email=eq.${email}&ativa=eq.true`, {
          method: "GET",
          headers: {
            apikey: supabaseKey,
            Authorization: `Bearer ${supabaseKey}`,
            "Content-Type": "application/json",
            "Accept": "application/json"
          }
        });
        const activeSessions = await resSessions.json();
        // Como o acesso √© restrito pelo IP definido (allowed_ip), permitimos quantas sess√µes forem originadas dele.

        // Gera um token √∫nico e obt√©m informa√ß√µes do dispositivo
        const sessionToken = generateToken();
        const deviceInfo = navigator.userAgent;

        // Cria a nova sess√£o na tabela "login_sessions"
        const novaSessao = {
          email: email,
          session_token: sessionToken,
          ativa: true,
          login_date: new Date().toISOString(),
          device_info: deviceInfo,
          ip_address: ipAddress
        };

        const resInsert = await fetch(`${supabaseUrl}/rest/v1/login_sessions`, {
          method: "POST",
          headers: {
            apikey: supabaseKey,
            Authorization: `Bearer ${supabaseKey}`,
            "Content-Type": "application/json"
          },
          body: JSON.stringify(novaSessao)
        });

        if (!resInsert.ok) {
          console.error("Erro ao criar a nova sess√£o:", resInsert.statusText);
          alert("Erro ao criar sess√£o. Tente novamente.");
          return;
        }

        // Salva os dados da sess√£o no localStorage
        localStorage.setItem("user_email", email);
        localStorage.setItem("login_date", new Date().toISOString());
        localStorage.setItem("session_token", sessionToken);

        // Atualiza a interface: esconde a √°rea de login e mostra a √°rea de busca/conte√∫do
        document.getElementById('introSection').style.display = 'none';
        document.getElementById('planosSection').style.display = 'none';
        document.getElementById('loginArea').classList.add('hidden');
        document.getElementById('searchSection').classList.remove('hidden');
        document.getElementById('menuPlanos').classList.add('hidden');
        document.getElementById('planosToggle').classList.remove('hidden');
        document.getElementById('menuLogin').innerText = 'Sair';
        document.getElementById('menuLogin').setAttribute('onclick', 'logout()');

        // Exibe mensagem de boas-vindas utilizando o primeiro nome (registro.nome) e carrega os dados
        document.querySelector("#searchSection .bg-gray-800").innerHTML = `<strong>Bem-vindo(a), ${registro.nome}!</strong>`;
        loadData();
      } catch (err) {
        console.error(err);
        alert("‚ùå Ocorreu um erro ao verificar o e-mail.");
      }
    }

    // Fun√ß√£o de Logout utilizando a tabela "login_sessions"
    async function logout() {
      const email = localStorage.getItem("user_email");
      const sessionToken = localStorage.getItem("session_token");
      if (!email || !sessionToken) return;

      const supabaseUrl = "https://chjdjfycylqhxtfrbdxm.supabase.co";
      const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNoamRqZnljeWxxaHh0ZnJiZHhtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDIxNTg0MTYsImV4cCI6MjA1NzczNDQxNn0.GvMeSnBDF0CS9-uampycS-C4qqfMgTzSsjYGqHrOFXU";

      try {
        await fetch(`${supabaseUrl}/rest/v1/login_sessions?session_token=eq.${sessionToken}`, {
          method: "PATCH",
          headers: {
            apikey: supabaseKey,
            Authorization: `Bearer ${supabaseKey}`,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ ativa: false })
        });
      } catch (err) {
        console.error("Erro ao encerrar a sess√£o:", err);
      }

      // Limpa os dados do localStorage e restaura a interface
      localStorage.removeItem("user_email");
      localStorage.removeItem("login_date");
      localStorage.removeItem("session_token");

      document.getElementById('introSection').style.display = 'block';
      document.getElementById('planosSection').style.display = 'grid';
      document.getElementById('loginArea').classList.add('hidden');
      document.getElementById('searchSection').classList.add('hidden');
      document.getElementById('menuPlanos').classList.remove('hidden');
      document.getElementById('planosToggle').classList.add('hidden');
      document.getElementById('menuLogin').innerText = 'Login';
      document.getElementById('menuLogin').setAttribute('onclick', 'goToLogin()');
    }

    // Fun√ß√£o de valida√ß√£o peri√≥dica da sess√£o
    async function validateSession() {
      const email = localStorage.getItem("user_email");
      const storedToken = localStorage.getItem("session_token");
      if (!email || !storedToken) return;

      const supabaseUrl = "https://chjdjfycylqhxtfrbdxm.supabase.co";
      const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNoamRqZnljeWxxaHh0ZnJiZHhtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDIxNTg0MTYsImV4cCI6MjA1NzczNDQxNn0.GvMeSnBDF0CS9-uampycS-C4qqfMgTzSsjYGqHrOFXU";
      try {
        const res = await fetch(`${supabaseUrl}/rest/v1/login_sessions?email=eq.${email}&session_token=eq.${storedToken}`, {
          headers: {
            apikey: supabaseKey,
            Authorization: `Bearer ${supabaseKey}`,
            "Content-Type": "application/json"
          }
        });
        const result = await res.json();
        if (!result || result.length === 0 || result[0].ativa !== true) {
          // N√£o exibe alerta se for logout manual ou por fechamento da aba; apenas encerra a sess√£o
          logout();
        }
      } catch (err) {
        console.error("Erro na valida√ß√£o da sess√£o:", err);
      }
    }

    // Verifica a sess√£o a cada 60 segundos
    setInterval(validateSession, 60000);

    // Evento beforeunload: marca a sess√£o atual como inativa ao fechar a aba
    window.addEventListener("beforeunload", async () => {
      const sessionToken = localStorage.getItem("session_token");
      if (!sessionToken) return;
      const supabaseUrl = "https://chjdjfycylqhxtfrbdxm.supabase.co";
      const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNoamRqZnljeWxxaHh0ZnJiZHhtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDIxNTg0MTYsImV4cCI6MjA1NzczNDQxNn0.GvMeSnBDF0CS9-uampycS-C4qqfMgTzSsjYGqHrOFXU";
      try {
        await fetch(`${supabaseUrl}/rest/v1/login_sessions?session_token=eq.${sessionToken}`, {
          method: "PATCH",
          headers: {
            apikey: supabaseKey,
            Authorization: `Bearer ${supabaseKey}`,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({ ativa: false })
        });
      } catch (err) {
        console.error("Erro no beforeunload:", err);
      }
    });

    // Verifica√ß√£o autom√°tica da sess√£o ao carregar a p√°gina
    window.addEventListener('DOMContentLoaded', async () => {
      const email = localStorage.getItem("user_email");
      const storedToken = localStorage.getItem("session_token");
      if (!email || !storedToken) return;

      const supabaseUrl = "https://chjdjfycylqhxtfrbdxm.supabase.co";
      const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNoamRqZnljeWxxaHh0ZnJiZHhtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDIxNTg0MTYsImV4cCI6MjA1NzczNDQxNn0.GvMeSnBDF0CS9-uampycS-C4qqfMgTzSsjYGqHrOFXU";
      try {
        const res = await fetch(`${supabaseUrl}/rest/v1/login_sessions?email=eq.${email}&session_token=eq.${storedToken}`, {
          headers: {
            apikey: supabaseKey,
            Authorization: `Bearer ${supabaseKey}`,
            "Content-Type": "application/json"
          }
        });
        const result = await res.json();
        if (!result || result.length === 0 || result[0].ativa !== true) return;
        // Busca o registro na tabela "sessoes" para obter o primeiro nome
        const resSessoes = await fetch(`${supabaseUrl}/rest/v1/sessoes?email=eq.${email}`, {
          method: "GET",
          headers: {
            apikey: supabaseKey,
            Authorization: `Bearer ${supabaseKey}`,
            "Content-Type": "application/json",
            "Accept": "application/json"
          }
        });
        const autorizacoes = await resSessoes.json();
        let displayName = email;
        if (autorizacoes && autorizacoes.length > 0 && autorizacoes[0].nome) {
          displayName = autorizacoes[0].nome;
        }
        document.getElementById('introSection').style.display = 'none';
        document.getElementById('planosSection').style.display = 'none';
        document.getElementById('loginArea').classList.add('hidden');
        document.getElementById('searchSection').classList.remove('hidden');
        document.getElementById('menuPlanos').classList.add('hidden');
        document.getElementById('planosToggle').classList.remove('hidden');
        document.getElementById('menuLogin').innerText = 'Sair';
        document.getElementById('menuLogin').setAttribute('onclick', 'logout()');
        document.querySelector("#searchSection .bg-gray-800").innerHTML = `<strong>Bem-vindo(a), ${displayName}!</strong>`;
        loadData();
      } catch (err) {
        console.error("Erro ao verificar sess√£o autom√°tica:", err);
      }
    });

    function togglePlanos() {
      const planos = document.getElementById('planosSection');
      const planosAfter = document.getElementById('planosSectionAfter');
      const btn = document.getElementById('planosToggle');
      if (planosAfter.classList.contains('hidden')) {
        planosAfter.innerHTML = planos.innerHTML;
        planosAfter.classList.remove('hidden');
        btn.innerHTML = 'üí≥ Ver Planos -';
      } else {
        planosAfter.classList.add('hidden');
        btn.innerHTML = 'üí≥ Ver Planos +';
      }
    }

    function mostrarInicio() {
      document.getElementById('introSection').style.display = 'block';
      document.getElementById('planosSection').style.display = 'grid';
      document.getElementById('loginArea').classList.add('hidden');
      document.getElementById('searchSection').classList.add('hidden');
      document.getElementById('planosSectionAfter').classList.add('hidden');
    }

    function goToLogin() {
      document.getElementById('introSection').style.display = 'none';
      document.getElementById('planosSection').style.display = 'none';
      document.getElementById('searchSection').classList.add('hidden');
      document.getElementById('loginArea').classList.remove('hidden');
      document.getElementById('planosToggle').classList.add('hidden');
      document.getElementById('planosSectionAfter').classList.add('hidden');
    }
  </script>
</body>
</html>
