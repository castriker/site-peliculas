<!DOCTYPE html>
<!-- Meta Pixel Code -->
<script>
!function(f,b,e,v,n,t,s)
{if(f.fbq)return;n=f.fbq=function(){n.callMethod?
n.callMethod.apply(n,arguments):n.queue.push(arguments)};
if(!f._fbq)f._fbq=n;n.push=n;n.loaded=!0;n.version='2.0';
n.queue=[];t=b.createElement(e);t.async=!0;
t.src=v;s=b.getElementsByTagName(e)[0];
s.parentNode.insertBefore(t,s)}(window, document,'script',
'https://connect.facebook.net/en_US/fbevents.js');
fbq('init', '697769519885889');
fbq('track', 'PageView');
</script>
<noscript><img height="1" width="1" style="display:none"
src="https://www.facebook.com/tr?id=697769519885889&ev=PageView&noscript=1"
/></noscript>
<!-- End Meta Pixel Code -->

<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  
  <!-- favicon no formato .ico -->
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <link rel="shortcut icon" href="favicon.ico" type="image/x-icon">

<script>
  document.addEventListener('contextmenu', e => e.preventDefault());
  document.addEventListener('keydown', e => {
    if (
      e.keyCode === 123 ||
      (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J')) ||
      (e.ctrlKey && e.key === 'U') ||
      ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'c')
    ) {
      e.preventDefault();
    }
  });
</script>


  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Película Compatível</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Google Fonts: Montserrat -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;700;900&display=swap" rel="stylesheet">


  <!-- jsPDF para gerar PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

  <style>
body, html, * {
  -webkit-user-select: none !important;
  -moz-user-select: none !important;
  -ms-user-select: none !important;
  user-select: none !important;
  -webkit-touch-callout: none !important;
}
img, figure {
  pointer-events: none;
  -webkit-user-drag: none;
  user-drag: none;
}

body {
  background-color: #111;
  font-family: 'Montserrat', sans-serif;
  color: white;
  font-weight: 400;    /* peso normal para todo o corpo de texto */
}

    .badge {
      background-color: #e11d48;
      color: white;
      font-size: 0.75rem;
      padding: 0.25rem 0.75rem;
      border-radius: 9999px;
      font-weight: bold;
    }
    .highlight {
      /* Este estilo já aplica negrito e uma cor chamativa, e funciona com a animação definida na classe animate-blink */
      font-weight: bold;
      color: #ffea00;
    }
    @keyframes pulse {
      0%, 100% { box-shadow: 0 0 0 0 rgba(255,255,255,0.4); }
      50% { box-shadow: 0 0 0 10px rgba(255,255,255,0); }
    }
    /* Animação para o card 3 Meses (piscar) */
    @keyframes blink {
      0%, 50%, 100% { opacity: 1; }
      25%, 75% { opacity: 0.5; }
    }
    .animate-blink {
      animation: blink 2s infinite;
    }
    /* Estilo Premium para o Menu (underline animado) */
    .premium-link {
      position: relative;
    }
    .premium-link::after {
      content: "";
      position: absolute;
      width: 0%;
      height: 2px;
      bottom: -2px;
      left: 0;
      background-color: #FFC107;
      transition: width 0.3s ease;
    }
    .premium-link:hover::after {
      width: 100%;
    }
    .text-shadow {
      text-shadow: 1px 1px 2px rgba(0,0,0,0.8);
    }
    /* Alerta Importante – letra menor e padding reduzido */
    .alert-avisos {
      font-size: 0.875rem;
      padding: 0.75rem;
    }
    /* Forçar os inputs de texto (exceto e-mail) a exibirem em maiúsculas */
    input[type="text"] {
      text-transform: uppercase;
    }
    /* Modal título duplicado em vermelho */
    .modal-duplicate-title {
      color: red;
    }
/* Efeito de slide para o menu mobile */
#mobileMenu {
  transition: transform 0.3s cubic-bezier(.4,0,.2,1), opacity 0.2s;
  transform: translateX(100%);
  opacity: 0;
}
#mobileMenu.slide-in {
  transform: translateX(0);
  opacity: 1;
}

  </style>

  <!-- Bloqueia clique direito, atalhos para DevTools e Ctrl+C -->
  <script>
// Impede o menu ao tocar em imagens no mobile
document.querySelectorAll('img').forEach(img => {
  img.addEventListener('contextmenu', e => e.preventDefault());
  img.addEventListener('touchstart', e => e.preventDefault());
});

     document.addEventListener('contextmenu', e => e.preventDefault());
    document.addEventListener('keydown', e => {
      if (
        e.keyCode === 123 || 
        (e.ctrlKey && e.shiftKey && (e.key === 'I' || e.key === 'J')) || 
        (e.ctrlKey && e.key === 'U') || 
        ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 'c')
      ) {
        e.preventDefault();
      }
    });
  </script>

  <!-- Script para pré‑carregar o e‑mail salvo -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const saved = localStorage.getItem('saved_email');
      if (saved) {
        const emailInput = document.getElementById('email');
        const rememberCb = document.getElementById('rememberEmail');
        if (emailInput && rememberCb) {
          emailInput.value = saved;
          rememberCb.checked = true;
        }
      }
    });
  </script>
</head>
<body>
<div id="debugLog" style="
  position: fixed; bottom: 0; left: 0; right: 0;
  max-height: 150px; overflow-y: auto;
  background: rgba(0,0,0,0.8); color: #fff;
  font-size: 12px; padding: 4px; z-index: 9999;
"></div>

  <!-- Cabeçalho responsivo -->
<nav class="flex items-center justify-between p-4 bg-gradient-to-r from-black to-gray-800 shadow-xl text-white">
  <div class="text-2xl font-black tracking-widest text-shadow flex items-center gap-2">
    <svg class="w-8 h-8 text-yellow-400" fill="none" stroke="currentColor" stroke-width="2"
         viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"></svg>
    PELÍCULA COMPATÍVEL
  </div>
  <!-- Menu desktop -->
  <div class="hidden md:flex gap-6 text-base font-semibold">
    <a href="#introSection" onclick="mostrarInicio()" class="premium-link hover:text-yellow-400 transition">Início</a>
    <a href="#planosSection" onclick="mostrarPlanos()" class="premium-link hover:text-yellow-400 transition">Planos</a>
    <a href="https://wa.me/utidatecnologia" target="_blank" class="premium-link hover:text-yellow-400 transition">Contato</a>
    <a href="javascript:void(0)"
   id="menuLogin"
   onclick="goToLogin()"
   class="premium-link hover:text-yellow-400 transition">
  Login
</a>

  </div>
  <!-- Menu mobile (hambúrguer) -->
  <button id="menuBtn" class="md:hidden">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
    </svg>
  </button>
</nav>
<!-- Mobile menu (sidebar) -->
<div id="mobileMenu"
  class="md:hidden fixed top-0 right-0 w-2/3 max-w-xs h-full bg-gradient-to-br from-gray-900/95 to-gray-800/95 text-white p-8 z-50 hidden flex-col gap-6 shadow-2xl backdrop-blur-lg rounded-l-2xl">
  <!-- Por este SVG premium (ícone X) -->
<button id="closeMenu" class="absolute top-4 right-6">
  <svg xmlns="http://www.w3.org/2000/svg" class="w-8 h-8 text-gray-400 hover:text-yellow-400 transition" fill="none" viewBox="0 0 24 24" stroke="currentColor">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
  </svg>
</button>
<a href="#introSection" id="mobileMenuInicio" class="block w-full mb-2 px-4 py-3 rounded-xl text-lg font-semibold text-center transition bg-gray-900/80 hover:bg-yellow-400 hover:text-gray-900 shadow-lg">Início</a>
<a href="#planosSection" id="mobileMenuPlanos" class="block w-full mb-2 px-4 py-3 rounded-xl text-lg font-semibold text-center transition bg-gray-900/80 hover:bg-yellow-400 hover:text-gray-900 shadow-lg">Planos</a>
<a href="https://wa.me/utidatecnologia" id="mobileMenuContato" target="_blank" class="block w-full mb-2 px-4 py-3 rounded-xl text-lg font-semibold text-center transition bg-gray-900/80 hover:bg-yellow-400 hover:text-gray-900 shadow-lg">Contato</a>
<a href="javascript:void(0)" id="mobileMenuLogin" class="block w-full mb-2 px-4 py-3 rounded-xl text-lg font-semibold text-center transition bg-gray-900/80 hover:bg-yellow-400 hover:text-gray-900 shadow-lg">Login</a>
<a href="javascript:void(0)" id="mobileMenuLogout" class="block w-full mb-2 px-4 py-3 rounded-xl text-lg font-semibold text-center transition bg-gray-900/80 hover:bg-yellow-400 hover:text-gray-900 shadow-lg hidden">Sair</a>

</div>

<!-- Modal de confirmação customizado -->
<div id="confirmModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
  <div class="bg-gray-800 text-gray-100 p-4 rounded-lg w-80">
    <p id="confirmMessage" class="mb-4 text-sm"></p>
    <div class="flex justify-end space-x-2">
    <button id="confirmCancel" class="px-3 py-1 bg-gray-700 hover:bg-gray-600 rounded">
  Escolher
</button>
<button id="confirmOk" class="px-3 py-1 bg-green-600 hover:bg-green-500 rounded text-white">
  Adicionar do meu jeito
</button>
    </div>
  </div>
</div>


<script>
  // ─── 1) SLIDE MENU ────────────────────────────────────────────────────────────
  document.getElementById('menuBtn').onclick = () => {
    // Garante que o menu sempre mostra o estado correto
    const email = localStorage.getItem("user_email");
    if (email) {
      mostrarMenuMobileAposLogin();
    } else {
      mostrarMenuMobileAposLogout();
    }
    const menu = document.getElementById('mobileMenu');
    menu.classList.add('slide-in');
    menu.classList.remove('hidden');
  };

  document.getElementById('closeMenu').onclick = () => {
    const menu = document.getElementById('mobileMenu');
    menu.classList.remove('slide-in');
    setTimeout(() => menu.classList.add('hidden'), 300);
  };

  document.getElementById('mobileMenuPlanos').onclick = function(e) {
    e.preventDefault();
    const menu = document.getElementById('mobileMenu');
    menu.classList.remove('slide-in');
    setTimeout(() => {
      menu.classList.add('hidden');
      mostrarPlanos();
    }, 300);
  };

  document.getElementById('mobileMenuInicio').onclick = function(e) {
    e.preventDefault();
    const menu = document.getElementById('mobileMenu');
    menu.classList.remove('slide-in');
    setTimeout(() => {
      menu.classList.add('hidden');
      mostrarInicio();
    }, 300);
  };

  document.getElementById('mobileMenuContato').onclick = function() {
    const menu = document.getElementById('mobileMenu');
    menu.classList.remove('slide-in');
    setTimeout(() => menu.classList.add('hidden'), 300);
  };

  document.getElementById('mobileMenuLogin').onclick = function(e) {
    e.preventDefault();
    const menu = document.getElementById('mobileMenu');
    menu.classList.remove('slide-in');
    setTimeout(() => {
      menu.classList.add('hidden');
      goToLogin();
    }, 300);
  };

  document.getElementById('mobileMenuLogout').onclick = function(e) {
    e.preventDefault();
    logout();
    const menu = document.getElementById('mobileMenu');
    menu.classList.remove('slide-in');
    setTimeout(() => {
      menu.classList.add('hidden');
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }, 300);
  };

  function mostrarMenuMobileAposLogin() {
    document.getElementById('mobileMenuInicio').classList.add('hidden');
    document.getElementById('mobileMenuPlanos').classList.add('hidden');
    document.getElementById('mobileMenuLogin').classList.add('hidden');
    document.getElementById('mobileMenuLogout').classList.remove('hidden');
    document.getElementById('mobileMenuContato').classList.remove('hidden');
  }

  function mostrarMenuMobileAposLogout() {
    document.getElementById('mobileMenuInicio').classList.remove('hidden');
    document.getElementById('mobileMenuPlanos').classList.remove('hidden');
    document.getElementById('mobileMenuLogin').classList.remove('hidden');
    document.getElementById('mobileMenuLogout').classList.add('hidden');
    document.getElementById('mobileMenuContato').classList.remove('hidden');
  }

  // ─── 2) MODAL DE CONFIRMAÇÃO CUSTOMIZADO ──────────────────────────────────────
  function showConfirm(message, onOk, onCancel) {
    const modal = document.getElementById('confirmModal');
    document.getElementById('confirmMessage').textContent = message;

    // Limpa event handlers antigos
    const btnOk     = document.getElementById('confirmOk');
    const btnCancel = document.getElementById('confirmCancel');
    btnOk.replaceWith(btnOk.cloneNode(true));
    btnCancel.replaceWith(btnCancel.cloneNode(true));

    // Resgata de novo após clonagem
    const ok     = document.getElementById('confirmOk');
    const cancel = document.getElementById('confirmCancel');

    ok.addEventListener('click', () => {
      modal.classList.add('hidden');
      onOk();
    });
    cancel.addEventListener('click', () => {
      modal.classList.add('hidden');
      if (onCancel) onCancel();
    });

    modal.classList.remove('hidden');
  }

</script>


  <!-- Página Inicial: Introdução -->
  <section id="introSection" class="py-12 bg-[#0b1120] text-white">
    <div class="max-w-7xl mx-auto flex flex-col-reverse md:flex-row items-center px-4 lg:px-8">
      <!-- Texto -->
      <div class="w-full md:w-1/2 text-center md:text-left">
        <h2 class="text-3xl sm:text-4xl font-extrabold text-yellow-400 mb-4">
          <span class="inline-block">🧩</span> Encontre a película certa em segundos
        </h2>
        <p class="text-gray-300 text-lg mb-4">
          Você trabalha com celular e perde tempo testando películas ou pesquisando compatibilidades?<br>
          <span class="font-bold text-white">Esse site é pra você.</span>
        </p>
        <p class="text-gray-400 mb-4">
          Aqui você acessa uma <span class="text-yellow-400 font-bold">tabela completa e atualizada</span> com modelos compatíveis.<br>
          Economize tempo, evite erros e <span class="text-yellow-400 font-bold">venda mais com segurança</span>.
        </p>
        <div class="flex flex-wrap justify-center md:justify-start gap-3 mt-4">
          <span class="bg-green-600 text-white px-4 py-1 rounded-full text-sm"✔️ Fácil de usar</span>
          <span class="bg-green-600 text-white px-4 py-1 rounded-full text-sm">✔️ Sem propagandas</span>
          <span class="bg-green-600 text-white px-4 py-1 rounded-full text-sm">✔️ Atualizações automáticas</span>
        </div>
        <p class="text-white mt-6 text-lg">
          <span class="text-yellow-400 font-bold">A partir de R$ 12,00 por mês</span>, você transforma seu atendimento e ganha confiança no que oferece.
        </p>
      </div>
      <!-- Imagem -->
      <div class="w-full md:w-1/2 flex justify-center mb-8 md:mb-0">
        <img src="pelicua3d.png" alt="Películas 3D" class="max-w-xs sm:max-w-sm md:max-w-md lg:max-w-sm xl:max-w-md">
      </div>
    </div>
  </section> <!-- fim de #introSection -->

<section id="promoPedido" class="py-16 bg-gradient-to-r from-yellow-500 to-yellow-600 text-gray-900">
  <div class="max-w-6xl mx-auto px-6 flex flex-col lg:flex-row items-center gap-12">
    <!-- Texto Promocional -->
    <div class="lg:w-1/2 space-y-6">
      <h2 class="text-4xl sm:text-5xl font-extrabold leading-tight relative">
        Muito mais que <span class="text-white">Compatibilidade!</span>
        <span class="absolute -top-4 -left-6 text-yellow-300 text-6xl opacity-30"></span>
      </h2>
      <p class="text-lg sm:text-xl">Assinando nosso plano você tem:</p>
      <ul class="space-y-4">
        <li class="flex items-start"><svg class="w-6 h-6 text-white mr-2" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19l12-12-1.41-1.41z"/></svg><span>Acesso ilimitado à tabela completa de modelos compatíveis</span></li>
        <li class="flex items-start"><svg class="w-6 h-6 text-white mr-2" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19l12-12-1.41-1.41z"/></svg><span>Ferramenta de pedido integrada</span></li>
        <li class="flex items-start"><svg class="w-6 h-6 text-white mr-2" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19l12-12-1.41-1.41z"/></svg><span>PDF de pedido pronto para enviar ao fornecedor em segundos</span></li>
      </ul>
      <button onclick="mostrarPlanos()" class="mt-6 bg-gray-900 text-yellow-400 px-10 py-4 rounded-full font-extrabold shadow-lg transform hover:scale-105 transition duration-300">
        Quero este Plano e o Pedido Automático
      </button>
    </div>
    <!-- Imagens Responsivas -->
    <div class="lg:w-1/2">
      <!-- Overlay desktop -->
      <div class="hidden lg:block relative h-80">
        <figure class="absolute top-0 left-0 w-2/3 bg-white rounded-xl shadow-lg overflow-hidden transform -rotate-3 hover:rotate-0 transition duration-500 z-10 cursor-pointer promo-image" data-src="https://raw.githubusercontent.com/castriker/site-peliculas/main/pedido%20de%20peliculas.jpg">
          <img src="https://raw.githubusercontent.com/castriker/site-peliculas/main/pedido%20de%20peliculas.jpg" class="w-full h-full object-cover" alt="Pedido de Películas">
        </figure>
        <figure class="absolute bottom-0 left-1/4 w-2/3 bg-white rounded-xl shadow-lg overflow-hidden transform rotate-3 hover:rotate-0 transition duration-500 z-10 cursor-pointer promo-image" data-src="https://raw.githubusercontent.com/castriker/site-peliculas/main/modelo%20compativel.jpg">
          <img src="https://raw.githubusercontent.com/castriker/site-peliculas/main/modelo%20compativel.jpg" class="w-full h-full object-cover" alt="Modelo Compatível">
        </figure>
        <figure class="absolute inset-y-1/4 right-0 w-2/3 bg-white rounded-xl shadow-2xl overflow-hidden transform hover:scale-105 transition duration-500 z-20 cursor-pointer promo-image" data-src="https://raw.githubusercontent.com/castriker/site-peliculas/main/area%20de%20pedidos.jpg">
          <img src="https://raw.githubusercontent.com/castriker/site-peliculas/main/area%20de%20pedidos.jpg" class="w-full h-full object-cover" alt="Área de Pedidos">
        </figure>
      </div>
      <!-- Carousel mobile -->
      <div class="block lg:hidden flex space-x-4 overflow-x-auto py-4 scroll-smooth">
        <img src="https://raw.githubusercontent.com/castriker/site-peliculas/main/pedido%20de%20peliculas.jpg" class="w-64 flex-shrink-0 rounded-xl shadow-lg cursor-pointer promo-image" data-src="https://raw.githubusercontent.com/castriker/site-peliculas/main/pedido%20de%20peliculas.jpg" alt="Pedido de Películas">
        <img src="https://raw.githubusercontent.com/castriker/site-peliculas/main/modelo%20compativel.jpg" class="w-64 flex-shrink-0 rounded-xl shadow-lg cursor-pointer promo-image" data-src="https://raw.githubusercontent.com/castriker/site-peliculas/main/modelo%20compativel.jpg" alt="Modelo Compatível">
        <img src="https://raw.githubusercontent.com/castriker/site-peliculas/main/area%20de%20pedidos.jpg" class="w-64 flex-shrink-0 rounded-xl shadow-lg cursor-pointer promo-image" data-src="https://raw.githubusercontent.com/castriker/site-peliculas/main/area%20de%20pedidos.jpg" alt="Área de Pedidos">
      </div>
    </div>
  </div>
  <!-- Lightbox Modal -->
  <div id="imageModal" class="hidden fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50">
    <button id="closeModal" class="absolute top-6 right-6 text-white text-3xl font-bold">×</button>
    <img id="modalImage" class="max-w-[90vw] max-h-[90vh] object-contain" alt="Imagem ampliada">
  </div>
  <script>
    document.querySelectorAll('.promo-image').forEach(el => el.addEventListener('click', () => {
      document.getElementById('modalImage').src = el.getAttribute('data-src');
      document.getElementById('imageModal').classList.remove('hidden');
    }));
    document.getElementById('closeModal').addEventListener('click', () => document.getElementById('imageModal').classList.add('hidden'));
    document.getElementById('imageModal').addEventListener('click', e => { if (e.target.id === 'imageModal') e.currentTarget.classList.add('hidden'); });
  </script>
</section>



  <!-- Seção de Planos -->
<!-- Título dos Planos -->
<section class="text-center py-12 bg-[#121212]">
  <h2 class="text-4xl font-extrabold text-yellow-400">Escolha seu Plano</h2>
  <p class="text-gray-300 mt-2">Acesse nossa tabela de películas compatíveis com desconto progressivo.</p>
</section>

<section
  id="planosSection"
  class="flex flex-col gap-4 px-4 sm:px-8 py-8 lg:grid lg:grid-cols-4 max-w-7xl mx-auto"
>


  <!-- Card 1 Mês -->
  <div class="relative w-full lg:min-w-0 flex-shrink-0 bg-white text-black rounded-xl p-6 shadow-md flex flex-col justify-between text-center">
    <div>
      <div class="badge bg-gray-300 text-gray-800 absolute top-2 right-2">0% OFF</div>
      <h3 class="text-lg sm:text-xl font-bold">1 Mês</h3>
      <p class="text-3xl sm:text-4xl font-extrabold mt-2">R$ 16,00</p>
      <p class="text-sm text-gray-600 mb-3">Total: R$ 16,00</p>
      <ul class="text-sm sm:text-base mb-6 text-left space-y-1">
        <li>📄 Acesso à tabela completa</li>
        <li>🔄 Atualizações automáticas</li>
        <li>🚫 Sem propagandas</li>
<li>Permite acesso por até <b>2 dispositivos: 📱💻🖥️</b>.</li>
<small class="text-xs text-gray-500">
  Exemplo: 1 celulares, 1 computadores, ou da forma que preferir!
</small>
      </ul>
    </div>
    <button onclick="window.open('https://uti-da-tecnologia2.pay.yampi.com.br/r/L7UUL12E94', '_blank')"
            class="w-full bg-black text-white py-3 rounded-lg font-semibold hover:opacity-80 transition text-sm sm:text-base">
      💳 Comprar
    </button>
  </div>

<!-- Card 3 Meses (pisca) -->
<div
  class="relative w-full lg:min-w-0 flex-shrink-0    /* largura carrossel no mobile */
         bg-[#fffbea] text-black rounded-xl p-6
         text-center shadow-[0_0_25px_rgba(255,204,0,0.5)]
         border-2 border-yellow-400
         flex flex-col justify-between
         animate-blink"
>
  <!-- Selo Mais Vendido -->
  <div class="absolute -top-4 left-1/2 transform -translate-x-1/2
              bg-yellow-400 text-black px-3 py-1 rounded-full text-xs shadow-lg">
    MAIS VENDIDO
  </div>

  <!-- Título e valores -->
  <h3 class="text-xl font-normal flex justify-center items-center gap-2">⭐ 3 Meses</h3>
  <p class="text-3xl font-normal mt-2">R$ 14,00</p>
  <p class="text-sm text-gray-600 mb-3 font-normal">Total: R$ 42,00</p>

  <!-- Lista de benefícios -->
  <ul class="text-sm sm:text-base mb-4 text-left space-y-1 font-normal">
    <li>📄 Acesso à tabela completa</li>
    <li>🔄 Atualizações automáticas</li>
    <li>🚫 Sem propagandas</li>
<li>Permite acesso por até <b>3 dispositivos: 📱💻🖥️</b>.</li>
<small class="text-xs text-gray-500">
  Exemplo: 1 celulares, 2 computadores, ou da forma que preferir!
</small>
  </ul>

  <!-- Botão -->
  <button
    onclick="window.open('https://uti-da-tecnologia2.pay.yampi.com.br/r/2ZCQB5IF4K', '_blank')"
    class="w-full bg-black text-white py-3 rounded-lg font-semibold hover:opacity-80 transition text-sm sm:text-base"
  >
    💳 Comprar
  </button>
</div>

  <!-- Card 6 Meses -->
 <div class="relative w-full lg:min-w-0 flex-shrink-0 bg-white text-black rounded-xl p-6 shadow-md flex flex-col justify-between text-center">

    <div>
      <div class="badge absolute top-2 right-2">18,75% OFF</div>
      <h3 class="text-lg sm:text-xl font-bold">6 Meses</h3>
      <p class="text-3xl sm:text-4xl font-extrabold mt-2">R$ 13,00</p>
      <p class="text-sm text-gray-600 mb-3">Total: R$ 78,00</p>
      <ul class="text-sm sm:text-base mb-6 text-left space-y-1">
        <li>📄 Acesso à tabela completa</li>
        <li>🔄 Atualizações automáticas</li>
        <li>🚫 Sem propagandas</li>
<li>Permite acesso por até <b>4 dispositivos: 📱💻🖥️</b>.</li>
<small class="text-xs text-gray-500">
  Exemplo: 2 celulares, 2 computadores, ou da forma que preferir!
</small>
      </ul>
    </div>
    <button onclick="window.open('https://uti-da-tecnologia2.pay.yampi.com.br/r/C4YDHJV3JQ', '_blank')"
            class="w-full bg-black text-white py-3 rounded-lg font-semibold hover:opacity-80 transition text-sm sm:text-base">
      💳 Comprar
    </button>
  </div>

  <!-- Card 1 Ano -->
<div class="relative w-full lg:min-w-0 flex-shrink-0 bg-white text-black rounded-xl p-6 shadow-md flex flex-col justify-between text-center">

    <div>
      <div class="badge absolute top-2 right-2">25% OFF</div>
      <h3 class="text-lg sm:text-xl font-bold">1 Ano</h3>
      <p class="text-3xl sm:text-4xl font-extrabold mt-2">R$ 12,00</p>
      <p class="text-sm text-gray-600 mb-3">Total: R$ 144,00</p>
      <ul class="text-sm sm:text-base mb-6 text-left space-y-1">
        <li>📄 Acesso à tabela completa</li>
        <li>🔄 Atualizações automáticas</li>
        <li>🚫 Sem propagandas</li>
<li>Permite acesso por até <b>5 dispositivos: 📱💻🖥️</b>.</li>
<small class="text-xs text-gray-500">
  Exemplo: 3 celulares, 2 computadores, ou da forma que preferir!
</small>
      </ul>
    </div>
    <button onclick="window.open('https://uti-da-tecnologia2.pay.yampi.com.br/r/CBYZ9T0HR1', '_blank')"
            class="w-full bg-black text-white py-3 rounded-lg font-semibold hover:opacity-80 transition text-sm sm:text-base">
      💳 Comprar
    </button>
  </div>
</section>


  <!-- Seção de Pedidos -->
  <section id="orderSection" class="hidden max-w-4xl mx-auto mt-10 p-4">
    <div class="mb-4 bg-gray-800 text-center p-4 rounded-lg">
      <strong>Área de Pedidos</strong>
    </div>
<div class="bg-gray-700 p-4 rounded-lg mb-4">
  <div class="flex flex-wrap items-center gap-2">
    <!-- Label do modelo -->
    <label for="orderModelo" class="text-sm font-medium whitespace-nowrap">
      Modelo da película
    </label>

    <!-- Input de modelo (menor largura) -->
    <input
      type="text"
      id="orderModelo"
      placeholder="ex: A10"
      class="flex-1 max-w-xs p-2 text-black rounded-lg"
    />

    <!-- Label da quantidade abreviada -->
    <label for="orderQuantidade" class="text-sm font-medium whitespace-nowrap">
      Quantidade
    </label>

    <!-- Input de quantidade (fixo) -->
    <input
      type="number"
      id="orderQuantidade"
      placeholder="Ex. 1"
      class="w-16 p-2 text-black rounded-lg"
      min="1"
    />

    <!-- Botão de adicionar -->
    <button
      onclick="adicionarPedido()"
      class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded text-sm"
    >
      Adicionar
    </button>
  </div>

  <!-- mantém o resultado da busca aqui -->
  <div id="orderResult" class="hidden p-2 bg-gray-600 rounded-lg text-sm text-white font-light leading-relaxed mt-2"></div>
</div>

    <div class="bg-gray-700 p-4 rounded-lg">
      <h3 class="text-lg font-semibold mb-2">Itens do Pedido</h3>
      <div id="pedidoItens" class="text-sm">
        <p class="text-gray-300">Nenhum item adicionado ainda.</p>
      </div>
      <button onclick="gerarPDFPedido()" class="mt-4 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded transition text-sm sm:text-base">
        Gerar PDF do Pedido
      </button>
<button onclick="voltarConsulta()"
        class="mt-2 bg-gray-500 hover:bg-gray-600 text-white font-semibold py-2 px-4 rounded transition text-sm sm:text-base">
  ← Voltar à Consulta
</button>
<button onclick="limparPedido()"
        class="mt-2 bg-red-600 hover:bg-red-700 text-white font-semibold py-2 px-4 rounded transition text-sm sm:text-base">
  Limpar Pedido
</button>
<button id="btnSalvarPedido"
        class="mt-2 bg-yellow-500 hover:bg-yellow-600 text-white font-semibold py-2 px-4 rounded text-sm sm:text-base">
  💾 Salvar Pedido
</button>


    </div>
  </section>

  <!-- Área de Login -->
  <section id="loginArea" class="max-w-4xl mx-auto p-4 sm:p-6 hidden">
    <label class="block mb-2 font-medium text-sm sm:text-base">Digite seu e‑mail para acessar</label>
    <input type="email" id="email" placeholder="Digite seu e‑mail" class="w-full p-3 text-black rounded-lg mb-2 text-sm sm:text-base" />
    <div class="mb-4">
      <label class="inline-flex items-center space-x-2 text-sm">
        <input type="checkbox" id="rememberEmail" class="text-blue-600 border-gray-300 rounded focus:ring-0" />
        <span>Lembrar meu e‑mail</span>
      </label>
    </div>
    <button onclick="checkEmail()"
            class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg shadow-md border border-blue-500 transition text-sm sm:text-base">
      🔐 Entrar
    </button>
  </section>

  <!-- Área de Busca (Compatibilidade) -->
  <section id="searchSection" class="hidden max-w-4xl mx-auto mt-10 p-4">
    <div class="mb-4 bg-gray-800 text-center p-4 rounded-lg">
      <strong id="welcomeMsg">Bem-vindo(a)!</strong>
    </div>
    <div class="mb-4 bg-red-600 text-white alert-avisos rounded-lg">
      <strong>Aviso Importante:</strong> Ao aplicar qualquer película, meça cuidadosamente o tamanho, verifique bordas, localização de câmera e demais recortes pois pode haver diferença nas películas de acordo com o fabricante. O site isenta-se de quaisquer responsabilidades.
    </div>
    <label class="block mb-2 text-sm font-medium">Digite o modelo do celular</label>
    <input type="text" id="searchModel" placeholder="Digite o modelo" class="w-full p-3 text-black rounded-lg mb-4"/>
    <div id="result" class="p-4 bg-gray-700 rounded-lg hidden font-light leading-relaxed"></div>

    <!-- Botões da área de busca -->
    <div class="flex flex-col sm:flex-row gap-2">
      <button onclick="abrirModalIncompatibilidade()" class="bg-yellow-400 hover:bg-yellow-500 text-black font-semibold py-2 px-4 rounded transition text-sm sm:text-base">
        Relatar Incompatibilidade
      </button>
      <button onclick="abrirModalCompatibilidade()" class="bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded transition text-sm sm:text-base">
        Adicionar Compatibilidade
      </button>
      <button onclick="mostrarPedidos()" class="bg-indigo-600 hover:bg-indigo-700 text-white font-semibold py-2 px-4 rounded transition text-sm sm:text-base">
        Fazer Pedido
      </button>
    </div>
  </section>

  <!-- Modal de Relatar Incompatibilidade -->
  <div id="modalIncompatibilidade" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50">
    <div class="bg-white text-black w-11/12 max-w-sm p-6 rounded shadow-lg">
      <h2 class="text-lg font-bold mb-4">Relatar Incompatibilidade</h2>
      <label class="block mb-2 text-sm font-medium" for="modeloTestado">Modelo testado</label>
      <input type="text" id="modeloTestado" class="w-full p-2 mb-4 rounded border border-gray-300 text-sm sm:text-base" placeholder="Ex: IPHONE 14" />
      <label class="block mb-2 text-sm font-medium" for="modeloIncompativel">Modelo incompatível</label>
      <input type="text" id="modeloIncompativel" class="w-full p-2 mb-4 rounded border border-gray-300 text-sm sm:text-base" placeholder="Ex: SAMSUNG A10" />
      <div class="flex justify-end space-x-2">
        <button onclick="fecharModalIncompatibilidade()" class="bg-gray-300 hover:bg-gray-400 text-black font-semibold py-2 px-4 rounded">
          Fechar
        </button>
        <button onclick="enviarIncompatibilidade()" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded">
          Enviar
        </button>
      </div>
    </div>
  </div>

  <!-- Modal de Adicionar Compatibilidade -->
  <div id="modalCompatibilidade" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50">
    <div class="bg-white text-black w-11/12 max-w-sm p-6 rounded shadow-lg">
      <h2 class="text-lg font-bold mb-4">Adicionar Compatibilidade</h2>
      <label class="block mb-2 text-sm font-medium" for="modeloProcuradoCompat">Modelo Procurado</label>
      <input type="text" id="modeloProcuradoCompat" class="w-full p-2 mb-4 rounded border border-gray-300 text-sm sm:text-base" placeholder="MODELO PESQUISADO" />
      <label class="block mb-2 text-sm font-medium" for="modeloCompativel">Modelo Compatível</label>
      <input type="text" id="modeloCompativel" class="w-full p-2 mb-4 rounded border border-gray-300 text-sm sm:text-base" placeholder="Ex: SAMSUNG GALAXY A10" />
      <div class="flex justify-end space-x-2">
        <button onclick="fecharModalCompatibilidade()" class="bg-gray-300 hover:bg-gray-400 text-black font-semibold py-2 px-4 rounded">
          Fechar
        </button>
        <button onclick="enviarCompatibilidade()" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded">
          Enviar
        </button>
      </div>
    </div>
  </div>

<!-- Modal de Duplicata -->
<div id="modalDuplicate" class="hidden fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50">
  <div class="bg-white text-black w-11/12 max-w-sm p-6 rounded shadow-lg">
    <h2 class="text-lg font-bold mb-4 modal-duplicate-title">ITEM DUPLICADO</h2>
    <p id="duplicateMessage" class="mb-4 text-sm"></p>
    <div class="flex justify-end space-x-2">
      <button onclick="cancelarDuplicata()" class="bg-gray-300 …">Cancelar</button>
    <button onclick="alterarQtdDuplicado()" class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-2 px-4 rounded">
  Alterar Quantidade
</button>
      <button onclick="adicionarMesmoModelo()" class="bg-green-600 …">Adicionar Mesmo Assim</button>
    </div>
  </div>
</div>


  <!-- Rodapé Principal -->
  <footer class="text-center text-gray-400 text-sm py-8">
    Copyright &copy; 2021 UTI Da Tecnologia - Todos os Direitos Reservados.
    <br>Desenvolvido por <strong>Carla Vasconcelos</strong> (UTI Da Tecnologia).
  </footer>

  <!-- Rodapé Legal -->
  <footer class="bg-gray-900 text-gray-400 text-sm py-4">
    <div class="max-w-6xl mx-auto flex justify-center space-x-8">
      <a href="javascript:void(0)" onclick="mostrarLegal('quem-somos')" class="hover:text-yellow-400">Quem Somos</a>
      <a href="javascript:void(0)" onclick="mostrarLegal('termos-uso')" class="hover:text-yellow-400">Termos de Uso</a>
      <a href="javascript:void(0)" onclick="mostrarLegal('politica-privacidade')" class="hover:text-yellow-400">Política de Privacidade</a>
    </div>
  </footer>

  <!-- Seções Legais (ocultas) -->
  <section id="legalContentContainer" class="max-w-6xl mx-auto py-8 px-4 hidden">
    <div id="quem-somos" class="legal-section hidden">
      <h2 class="text-2xl font-bold text-yellow-400 mb-4">Quem Somos</h2>
      <p>Somos a UTI Da Tecnologia, uma equipe especializada em fornecer informações atualizadas sobre películas compatíveis para dispositivos móveis. Nossa missão é facilitar o acesso às informações e ajudar profissionais no atendimento e venda de películas com qualidade e confiabilidade. Liderada por Carla Vasconcelos, nossa empresa é comprometida em oferecer sempre o melhor para nossos clientes.</p>
    </div>
    <div id="termos-uso" class="legal-section hidden border-t border-gray-700 mt-8 pt-8">
      <h2 class="text-2xl font-bold text-yellow-400 mb-4">Termos de Uso</h2>
      <p>Bem-vindo ao site Películas Compatíveis. Ao acessar ou utilizar nosso site, você concorda em cumprir e aceitar integralmente os presentes Termos de Uso. Caso discorde de algum item, solicitamos que não utilize este site.</p>
      <h3 class="text-xl font-bold mt-4">1. Utilização do Site</h3>
      <p>Este site foi desenvolvido com o objetivo de fornecer informações detalhadas e precisas sobre películas compatíveis com diversos modelos de dispositivos eletrônicos. Você deve utilizar este site exclusivamente para fins legítimos, garantindo não infringir direitos de terceiros ou causar qualquer prejuízo ao site ou aos demais usuários.</p>
      <p>É expressamente proibido:</p>
      <ul class="list-disc pl-5">
        <li>Acessar o site por meio de métodos ilegais ou não autorizados;</li>
        <li>Realizar qualquer ação que possa sobrecarregar ou prejudicar a infraestrutura do site;</li>
        <li>Utilizar ferramentas ou softwares para extrair conteúdo ou dados sem autorização prévia por escrito.</li>
      </ul>
      <h3 class="text-xl font-bold mt-4">2. Propriedade Intelectual</h3>
      <p>Todo o conteúdo disponível neste site, incluindo textos, imagens, gráficos, logotipos, ícones, áudios e vídeos, é propriedade exclusiva deste site e está protegido pelas leis nacionais e internacionais de direitos autorais e propriedade intelectual.</p>
      <p>É terminantemente proibido reproduzir, distribuir, modificar ou comercializar qualquer conteúdo do site sem consentimento prévio e expresso do administrador.</p>
      <h3 class="text-xl font-bold mt-4">3. Responsabilidade e Garantias</h3>
      <p>O site Películas Compatíveis disponibiliza conteúdo informativo com o maior rigor possível, porém não oferece garantias expressas ou implícitas quanto à exatidão, integridade ou adequação dessas informações.</p>
      <p>O uso das informações disponibilizadas é de responsabilidade exclusiva do usuário. Em hipótese alguma seremos responsabilizados por quaisquer danos diretos, indiretos ou consequenciais decorrentes do uso ou da impossibilidade de uso do site, incluindo falhas técnicas ou problemas causados por vírus ou outras ameaças digitais.</p>
      <h3 class="text-xl font-bold mt-4">4. Modificação dos Termos</h3>
      <p>Reservamo-nos o direito de modificar ou atualizar estes Termos de Uso a qualquer momento e sem aviso prévio. As alterações serão imediatamente válidas após a publicação em nosso site. A continuidade do uso após a publicação das modificações implica a aceitação dos novos termos.</p>
      <h3 class="text-xl font-bold mt-4">5. Lei Aplicável e Jurisdição</h3>
      <p>Os presentes Termos de Uso são regidos e interpretados segundo as leis vigentes no Brasil. Eventuais disputas relacionadas a estes termos serão resolvidas no foro da cidade sede da administração do site, com renúncia expressa a qualquer outro.</p>
      <h3 class="text-xl font-bold mt-4">6. Contato</h3>
      <p>Em caso de dúvidas sobre estes Termos de Uso ou sobre o funcionamento do site, entre em contato pela aba "Contato".</p>
      <p class="mt-4">Última atualização: 14/04/2025</p>
    </div>
    <div id="politica-privacidade" class="legal-section hidden border-t border-gray-700 mt-8 pt-8">
      <h2 class="text-2xl font-bold text-yellow-400 mb-4">Política de Privacidade</h2>
      <p>Sua privacidade é nossa prioridade. Nesta Política de Privacidade, explicamos como coletamos, usamos e protegemos suas informações quando você utiliza o site Películas Compatíveis.</p>
      <h3 class="text-xl font-bold mt-4">1. Coleta de Informações</h3>
      <p>Coletamos informações pessoais quando você se registra, faz login ou utiliza determinados serviços do site. Essas informações podem incluir seu nome, e‑mail, endereço IP e dados de uso.</p>
      <h3 class="text-xl font-bold mt-4">2. Uso das Informações</h3>
      <p>Utilizamos os dados coletados para melhorar a experiência do usuário, fornecer suporte, enviar comunicações relevantes e assegurar o bom funcionamento do site. Não compartilhamos seus dados pessoais com terceiros sem o seu consentimento, exceto quando exigido por lei.</p>
      <h3 class="text-xl font-bold mt-4">3. Segurança</h3>
      <p>Adotamos medidas técnicas e administrativas para proteger suas informações contra acessos não autorizados, divulgação, alteração ou destruição. Contudo, nenhum método de transmissão ou armazenamento é 100% seguro.</p>
      <h3 class="text-xl font-bold mt-4">4. Cookies</h3>
      <p>Utilizamos cookies para melhorar sua experiência, armazenar preferências e coletar informações analíticas sobre o uso do site. Você pode desativar os cookies, mas isso pode afetar a funcionalidade do site.</p>
      <h3 class="text-xl font-bold mt-4">5. Alterações nesta Política</h3>
      <p>Podemos atualizar esta Política de Privacidade periodicamente, e a versão atualizada estará disponível nesta página. O uso contínuo do site implica a aceitação das alterações.</p>
      <h3 class="text-xl font-bold mt-4">6. Contato</h3>
      <p>Se tiver dúvidas sobre esta Política de Privacidade, entre em contato pela aba "Contato".</p>
      <p class="mt-4">Última atualização: 14/04/2025</p>
    </div>
    <div class="text-center mt-4">
      <button onclick="fecharLegal()" class="bg-blue-600 text-white py-2 px-4 rounded">Fechar</button>
    </div>
  </section>

  <script>
const supabaseUrl = "https://chjdjfycylqhxtfrbdxm.supabase.co";
  const supabaseKey = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNoamRqZnljeWxxaHh0ZnJiZHhtIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDIxNTg0MTYsImV4cCI6MjA1NzczNDQxNn0.GvMeSnBDF0CS9-uampycS-C4qqfMgTzSsjYGqHrOFXU";

function generateToken() {
  return Date.now().toString() + Math.random().toString(36).substr(2, 8);
}

function formatarData(dataString) {
  const partes = dataString.split("-");
  if (partes.length === 3) {
    return `${partes[2]}/${partes[1]}/${partes[0]}`;
  }
  return dataString;
}

function getBrasiliaISOString() {
  const now = new Date();
  now.setHours(now.getHours() - 3);
  return now.toISOString().slice(0, 19).replace('T', ' ');
}

// **NOVO** Função para piscar e focar um elemento
function blinkAndFocus(element) {
    if (!element) return;
    element.focus();
    const originalClass = element.className;
    // Adiciona classes para um destaque visual
    element.classList.add('border-red-500', 'border-2', 'shadow-lg', 'shadow-red-500/50');
    // Remove as classes de destaque após 1 segundo
    setTimeout(() => {
        element.className = originalClass;
    }, 1000);
}


    /* 2) Variáveis e Estruturas */
    let data = [];        // Base de compatibilidade
    let orderItems = [];  // Itens do pedido
	let duplicateGroup = [];
    let duplicateIndex = -1;

    /* 3) Carregar dados da planilha */
    function loadData() {
      fetch('https://script.google.com/macros/s/AKfycbwiDM-VA66hS8pnAGghwY2vxL3vqrRp9SIHmGc5AkwlMZeMYXg_An3dCvoJQUq6mJWTuA/exec')
        .then(response => response.json())
        .then(jsonData => {
          // row[0] → coluna A, row[1] → coluna B
data = jsonData.map(row => ({
  procurado:  row[0].trim(),   // modelo procurado
  compatíveis: row[1].trim()    // lista de compatíveis
}));
        });
    }

 /* 4) PESQUISA NA ABA DE COMPATIBILIDADE (searchModel) */
document
  .getElementById('searchModel')
  .addEventListener('input', function() {
    const raw = this.value;
    const resultEl = document.getElementById('result');
    if (!raw.trim()) {
      resultEl.classList.add('hidden');
      return;
    }

    // função de normalização, tokenização, etc...
    const normalize = str =>
      str.normalize('NFD')
         .replace(/[\u0300-\u036f]/g, '')
         .replace(/\s+/g, ' ')
         .toLowerCase()
         .trim();
    const tokens = normalize(raw).split(' ').filter(t => t);

    // filtra todos que contêm cada token
    const matches = data.filter(item => {
      const norm = normalize(item.procurado);
      return tokens.every(token => norm.includes(token));
    });
    if (!matches.length) {
      resultEl.textContent = 'MODELO NÃO ENCONTRADO';
      resultEl.classList.remove('hidden');
      return;
    }

    // prepara regex para highlight nos tokens
    const escRe = s => s.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');
    const tokensRe = tokens.map(t => new RegExp(`(${escRe(t)})`, 'gi'));

    resultEl.innerHTML = matches
      .map(item => {
        // 1) texto puro e highlight apenas nele
        let proc = item.procurado.toUpperCase();
        tokensRe.forEach(re => {
          proc = proc.replace(
            re,
            '<span class="highlight animate-blink">$1</span>'
          );
        });
        // 2) monta o card com os labels em amarelo+negrito
        return `
          <div class="bg-gray-800 text-gray-100 p-4 rounded-lg mb-3">
            <p class="mb-1">
              <span class="text-yellow-300 font-bold">MODELO PROCURADO:</span>
              ${proc}
            </p>
            <p>
              <span class="text-yellow-300 font-bold">MODELOS COMPATÍVEIS:</span>
              ${item.compatíveis.toUpperCase()}
            </p>
          </div>
        `;
      })
      .join('');

    resultEl.classList.remove('hidden');
  });


// ao clicar em uma das opções, preenche o campo e esconde o result
function selectModel(procurado) {
  document.getElementById('searchModel').value = procurado.toUpperCase();
  document.getElementById('result').classList.add('hidden');
}



/* 5) PESQUISA NA ABA DE PEDIDOS (orderModelo) */
document
  .getElementById('orderModelo')
  .addEventListener('input', function() {
    const raw = this.value;
    const orderResult = document.getElementById('orderResult');

    if (!raw.trim()) {
      orderResult.classList.add('hidden');
      orderResult.innerHTML = '';
      return;
    }

    // 1) Helpers de normalização e escape
    const normalize = str =>
      str
        .normalize('NFD')
        .replace(/[\u0300-\u036f]/g, '')
        .replace(/\s+/g, ' ')
        .toLowerCase()
        .trim();
    const escRe = s => s.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');

    // 2) Quebra em tokens
    const tokens = normalize(raw).split(' ').filter(t => t);

    // 3) Filtra TODOS que contêm todos os tokens
    const matches = data.filter(item => {
      const norm = normalize(item.procurado);
      return tokens.every(token => norm.includes(token));
    });

    // 4) Se achou correspondências, mostra opções clicáveis
    if (matches.length > 0) {
      const tokensRe = tokens.map(t => new RegExp(`(${escRe(t)})`, 'gi'));

      orderResult.innerHTML = matches
        .map(item => {
          // 4.1) Texto puro em UPPERCASE
          let proc = item.procurado.toUpperCase();
          // 4.2) Aplica highlight apenas no texto puro
          tokensRe.forEach(re => {
            proc = proc.replace(
              re,
              '<span class="highlight animate-blink">$1</span>'
            );
          });
          // 4.3) Monta o card com rótulos em amarelo+negrito
          return `
            <div
              class="bg-gray-800 text-gray-100 p-3 rounded-lg mb-2 cursor-pointer hover:bg-gray-700"
              onclick="preencherModelo('${item.procurado.replace(/'/g,"\\'")}')"
            >
              <p>
                <span class="text-yellow-300 font-bold">MODELO:</span>
                ${proc}
              </p>
              <p class="text-sm mt-1">
                <span class="text-yellow-300 font-bold">COMPATÍVEIS:</span>
                ${item.compatíveis.toUpperCase()}
              </p>
            </div>
          `;
        })
        .join('');

      orderResult.classList.remove('hidden');
      return;
    }

    // 5) Se não achar nenhum match, apenas esconde o painel
    orderResult.classList.add('hidden');
    orderResult.innerHTML = '';
  });

/* função para preencher o input ao clicar na sugestão */
function preencherModelo(valor) {
  document.getElementById('orderModelo').value = valor.toUpperCase();
  document.getElementById('orderResult').classList.add('hidden');
}

/* 6) findRowIndexForModel */
function findRowIndexForModel(input) {
  return data.findIndex(
    item => item.procurado.toLowerCase() === input.trim().toLowerCase()
  );
}



// helper de normalização (mesma lógica do listener)
function normalize(str) {
  return str
    .normalize('NFD')
    .replace(/[\u0300-\u036f]/g, '')
    .replace(/\s+/g, ' ')
    .toLowerCase()
    .trim();
}

function adicionarPedido() {
  const modeloInput = document.getElementById('orderModelo');
  const qtdInput    = document.getElementById('orderQuantidade');
  const raw         = modeloInput.value.trim();
  const quantidade  = qtdInput.value.trim();
  const upperRaw    = raw.toUpperCase();

  // 1) Validação básica
  if (!raw || !quantidade) {
    alert("Preencha o modelo e a quantidade antes de adicionar!");
    if (!raw)      blinkAndFocus(modeloInput);
    else if (!quantidade) blinkAndFocus(qtdInput);
    return;
  }

  // ─── 2) CHECAGEM DE DUPLICATA PELO TEXTO DIGITADO ───────────────────────────
  if (orderItems.some(item => item.modeloDigitado === upperRaw)) {
    // Se já existe um item com o mesmo modeloDigitado
    duplicateGroup = orderItems
      .map((item, idx) => item.modeloDigitado === upperRaw ? idx : -1)
      .filter(idx => idx !== -1);
    duplicateIndex = duplicateGroup[0];

    document.getElementById('duplicateMessage').innerText =
      `O modelo "${upperRaw}" já foi adicionado. O que deseja fazer?`;
    document.getElementById('modalDuplicate').classList.remove('hidden');
    return;
  }

  // ─── 3) Índice exato (se existir na base) ─────────────────────────────────
  const rowIndex = findRowIndexForModel(raw);

  // ─── 4) NORMALIZAÇÃO & SUGESTÕES ──────────────────────────────────────────
  const tokens      = normalize(raw).split(' ').filter(t => t);
  const suggestions = data.filter(item => {
    const norm = normalize(item.procurado);
    return tokens.every(token => norm.includes(token));
  });

// ─── 5) SE HOUVER SUGESTÕES, MOSTRA MODAL DE COMPATIBILIDADE ─────────────
if (rowIndex === -1 && suggestions.length > 0) {
  showConfirm(
    `Compatibilidades encontradas para "${upperRaw}".`,
    // onOk: adicionar mesmo sem ser exato
    () => {
      orderItems.push({ rowIndex, modeloDigitado: upperRaw, quantidade });
      atualizarListaPedidos();
    },
    // onCancel: volta o foco para escolher
    () => blinkAndFocus(modeloInput)
  );
  return;
}

  // ─── 6) SE NÃO HOUVER NEM SUGESTÕES, MOSTRA MODAL “NÃO ESTÁ NA BASE” ─────
  if (rowIndex === -1 && suggestions.length === 0) {
    showConfirm(
      `O modelo "${upperRaw}" não está na base de compatibilidade.`,
      () => {
        orderItems.push({ rowIndex, modeloDigitado: upperRaw, quantidade });
        atualizarListaPedidos();
      },
      () => blinkAndFocus(modeloInput)
    );
    return;
  }

  // ─── 7) CASO NORMAL: ADICIONA DIRETO (exato e sem confirmações) ────────────
  orderItems.push({ rowIndex, modeloDigitado: upperRaw, quantidade });
  atualizarListaPedidos();
}


    /* 8) Atualizar lista de pedidos */
function atualizarListaPedidos() {
  const pedidoItensDiv = document.getElementById('pedidoItens');
  if (orderItems.length === 0) {
    pedidoItensDiv.innerHTML = "<p class='text-gray-300'>Nenhum item adicionado ainda.</p>";
    return;
  }

  // 1) Empacota cada item com seu índice original
  const itemsWithIdx = orderItems
    .map((item, idx) => ({
      modelo: item.modeloDigitado.toUpperCase(),
      quantidade: item.quantidade,
      idx
    }))
    // 2) Ordena pelo modelo
    .sort((a, b) => a.modelo.localeCompare(b.modelo));

  // 3) Renderiza em lista
  let html = "<ul class='list-disc ml-5 space-y-1'>";
  itemsWithIdx.forEach(({ modelo, quantidade, idx }) => {
    html += `
      <li id="pedidoItem-${idx}" class="flex items-center gap-2">
        <span class="text-yellow-300 font-bold">${modelo}</span>
        <span class="text-white">– <strong>QTD:</strong> ${String(quantidade).padStart(2,'0')}</span>
        <button onclick="removerItemPedido(${idx})" class="bg-red-600 hover:bg-red-700 text-white ml-3 px-2 rounded text-xs">
          Remover
        </button>
        <button onclick="exibirInputEdicao(${idx})" class="bg-blue-600 hover:bg-blue-700 text-white ml-2 px-2 rounded text-xs">
          Alterar Qtde
        </button>
        <input type="number" id="editInput-${idx}" class="hidden w-16 p-1 text-black rounded text-xs ml-2"
               value="${quantidade}" min="1"
               onkeydown="if(event.key==='Enter'){salvarNovaQuantidade(${idx})}">
        <button id="saveBtn-${idx}" class="hidden bg-green-500 hover:bg-green-600 text-white px-2 rounded text-xs ml-1"
                onclick="salvarNovaQuantidade(${idx})">
          OK
        </button>
      </li>`;
  });
  html += "</ul>";

  pedidoItensDiv.innerHTML = html;
}

    /* 9) Edição e remoção de itens */
    function exibirInputEdicao(index) {
      const inputQtd = document.getElementById(`editInput-${index}`);
      const saveBtn = document.getElementById(`saveBtn-${index}`);
      if (!inputQtd || !saveBtn) return;
      inputQtd.classList.remove('hidden');
      saveBtn.classList.remove('hidden');
      inputQtd.focus();
    }
    function salvarNovaQuantidade(index) {
      const inputQtd = document.getElementById(`editInput-${index}`);
      if (!inputQtd) return;
      const novaQtd = inputQtd.value.trim();
      if (!novaQtd || parseInt(novaQtd) < 1) {
        alert("Quantidade inválida!");
        return;
      }
      orderItems[index].quantidade = novaQtd;
      atualizarListaPedidos();
    }
    function destacarItemNoPedido(index) {
      const li = document.getElementById(`pedidoItem-${index}`);
      if (!li) return;
      li.classList.add('bg-red-500');
      setTimeout(() => { li.classList.remove('bg-red-500'); }, 1000);
    }
    function removerItemPedido(index) {
      orderItems.splice(index, 1);
      atualizarListaPedidos();
    }

    /* 10) Modal de Duplicata */
    function cancelarDuplicata() {
      document.getElementById('modalDuplicate').classList.add('hidden');
      duplicateIndex = -1;
    }
function alterarQtdDuplicado() {
  document.getElementById('modalDuplicate').classList.add('hidden');
  if (duplicateGroup.length === 0) return;
  duplicateGroup.forEach(idx => destacarItemNoPedido(idx));
  exibirInputEdicao(duplicateGroup[0]);
  duplicateGroup = [];
}

function adicionarMesmoModelo() {
  // Esconde o modal
  document.getElementById('modalDuplicate').classList.add('hidden');

  // Captura o texto bruto e a quantidade
  const raw = document.getElementById('orderModelo').value.trim();
  const qtd = document.getElementById('orderQuantidade').value.trim();

  // Usa o findRowIndexForModel atual (que busca em item.procurado)
  const rowIndex = findRowIndexForModel(raw);

  // Adiciona aos itens do pedido
  orderItems.push({
    rowIndex,
    modeloDigitado: raw.toUpperCase(),
    quantidade: qtd
  });

  // Atualiza a lista e limpa os estados de duplicata
  atualizarListaPedidos();
  duplicateIndex = -1;
  duplicateGroup = [];
}



/* 11) Gerar PDF do Pedido (com paginação automática) */
function gerarPDFPedido() {
  if (orderItems.length === 0) {
    alert("Nenhum item no pedido para gerar PDF!");
    return;
  }

  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  // Configurações de paginação (mesmo código de antes)…
  const pageHeight = doc.internal.pageSize.getHeight();
  const marginTop = 20;
  const marginBottom = 20;
  const lineHeight = 10;
  const leftMargin = 20;
  let offsetY = marginTop;

  function drawHeader() {
    doc.setFont("helvetica", "bold");
    doc.setFontSize(18);
    doc.text("Pedido de Películas", leftMargin, offsetY);
    offsetY += lineHeight;
    doc.setFont("helvetica", "normal");
    doc.setFontSize(12);
  }

  drawHeader();

  orderItems.forEach((item, i) => {
    if (offsetY + marginBottom > pageHeight) {
      doc.addPage();
      offsetY = marginTop;
      drawHeader();
    }
    const text = `${i + 1}. Modelo: ${item.modeloDigitado.toUpperCase()} | Qtd: ${item.quantidade}`;
    doc.text(text, leftMargin, offsetY);
    offsetY += lineHeight;
  });

  if (offsetY + lineHeight + marginBottom > pageHeight) {
    doc.addPage();
    offsetY = marginTop;
  }
  offsetY += lineHeight;
  doc.text("Pedido gerado pelo site www.peliculasuti.com.br", leftMargin, offsetY);

  // Gera o PDF
  doc.save("pedido-peliculas.pdf");

  // AQUI: pergunta antes de limpar
  const desejaLimpar = confirm(
    "PDF gerado com sucesso!\n\n" +
    "*Clique em OK se tem CERTEZA que está tudo correto (PDF SERÁ GERADO) após seus itens apagados.\n" +

    "*Clique em Cancelar para manter os itens e continuar editando mesmo após gerar o PDF (PDF SERÁ GERADO)."
  );

  if (desejaLimpar) {
    orderItems = [];
    atualizarListaPedidos();
    deleteDraft();
  }
}


// 12) Função que faz o upsert em Supabase
async function salvarDraft() {
  const email = localStorage.getItem("user_email");
  if (!email) return alert("Você precisa estar logado para salvar o pedido.");

  // converte orderItems para JSON simples
  const payload = orderItems.map(i => ({
    modelo:     i.modeloDigitado,
    quantidade: i.quantidade,
    rowIndex:   i.rowIndex
  }));
  try {
    const res = await fetch(`${supabaseUrl}/rest/v1/draft_orders`, {
      method:  "POST",
      headers: {
        apikey:        supabaseKey,
        "Content-Type":  "application/json",
        Prefer:          "resolution=merge-duplicates"
      },
      body: JSON.stringify([{ email, items: payload }])
    });
    if (!res.ok) throw await res.text();
    alert("✅ Pedido salvo com sucesso!");
  } catch (err) {
    console.error(err);
    alert("❌ Falha ao salvar o pedido: " + err);
  }
}

// ─── Registra o listener UMA ÚNICA VEZ, fora da função ───
document
  .getElementById("btnSalvarPedido")
  .addEventListener("click", salvarDraft);



    /* 12) LOGIN / LOGOUT */
              // --- FUNÇÃO DE LOGIN REESCRITA COM A LÓGICA CORRETA ---
         // --- FUNÇÃO DE LOGIN REESCRITA COM A LÓGICA CORRETA E DIAGNÓSTICO ---
    async function checkEmail() {
      const email = document.getElementById('email').value.trim().toLowerCase();
      if (!email) {
        alert('Digite um e‑mail válido.');
        return;
      }

      // Salva o e-mail se a opção "lembrar" estiver marcada
      const rememberEmailChecked = document.getElementById('rememberEmail').checked;
      if (rememberEmailChecked) localStorage.setItem('saved_email', email);
      else localStorage.removeItem('saved_email');

      try {
        console.log(`--- INICIANDO VERIFICAÇÃO PARA: ${email} ---`);
        
        // --- ETAPA 1: Buscar os dados do plano do usuário ---
        const resPlano = await fetch(
          `${supabaseUrl}/rest/v1/sessoes?select=nome,plano,data_expiracao,max_devices&email=eq.${encodeURIComponent(email)}&timestamp=${Date.now()}`, {
            method: "GET",
            headers: { 
                apikey: supabaseKey,
                Authorization: `Bearer ${supabaseKey}`
            },
            cache: 'no-cache'
          }
        );

        if (!resPlano.ok) {
            console.error("Erro na resposta do Supabase ao buscar plano:", resPlano);
            throw new Error("Falha ao buscar dados do plano.");
        }
        const autorizacoes = await resPlano.json();

        if (!autorizacoes.length) {
          alert("E-mail não cadastrado em nenhum plano.");
          console.log("FIM: E-mail não encontrado.");
          return;
        }
        
        const registroPlano = autorizacoes[0];
        const maxDevices = parseInt(registroPlano.max_devices, 10) || 1; // Garante que é um número, ou 1 por padrão
        console.log(`[ETAPA 1] Limite de dispositivos para este plano: ${maxDevices}`);

        // Validação da data de expiração
        const hoje = new Date();
        const expira = new Date(registroPlano.data_expiracao);
        if (hoje > expira) {
          if (confirm(`Seu plano ${registroPlano.plano} expirou em ${formatarData(registroPlano.data_expiracao)}.\nClique em OK para ver nossos planos.`)) {
            mostrarPlanos();
          }
          console.log("FIM: Plano expirado.");
          return;
        }

        // --- ETAPA 2: Contar quantos dispositivos ESTE usuário já registrou ---
        const userDevicesUrl = `${supabaseUrl}/rest/v1/login_sessions?select=device_id&email=eq.${encodeURIComponent(email)}&timestamp=${Date.now()}`;
        const resUserDevices = await fetch(userDevicesUrl, {
            method: 'GET',
            headers: { 
                apikey: supabaseKey,
                Authorization: `Bearer ${supabaseKey}`
            },
            cache: 'no-cache'
        });

        if (!resUserDevices.ok) {
            console.error("Erro na resposta do Supabase ao buscar dispositivos:", resUserDevices);
            throw new Error("Falha ao contar dispositivos do usuário.");
        }
        
        const userSessions = await resUserDevices.json();
        const userUniqueDevices = new Set(userSessions.map(s => s.device_id));
        const registeredDeviceCount = userUniqueDevices.size;
        console.log(`[ETAPA 2] Dispositivos únicos já registrados para este e-mail: ${registeredDeviceCount}. IDs:`, Array.from(userUniqueDevices));

        // --- ETAPA 3: Obter e verificar o ID do dispositivo ATUAL ---
        let currentDeviceId = localStorage.getItem('device_id');
        if (!currentDeviceId) {
          currentDeviceId = generateToken();
          localStorage.setItem('device_id', currentDeviceId);
          console.log(`[ETAPA 3] Nenhum ID encontrado. NOVO ID gerado: ${currentDeviceId}`);
        } else {
          console.log(`[ETAPA 3] ID deste dispositivo encontrado no localStorage: ${currentDeviceId}`);
        }
        
        const isDeviceAlreadyRegisteredForThisUser = userUniqueDevices.has(currentDeviceId);
        console.log(`[ETAPA 3] Este dispositivo já está registrado para esta conta? ${isDeviceAlreadyRegisteredForThisUser}`);

        // --- ETAPA 4: LÓGICA DE DECISÃO FINAL ---
        if (isDeviceAlreadyRegisteredForThisUser) {
            console.log("[DECISÃO] PERMITIR. O dispositivo já é conhecido para esta conta.");
            await proceedWithLogin(email, currentDeviceId, registroPlano);
            return;
        }
        
        // Se chegou aqui, é um dispositivo novo para esta conta.
        console.log("[LÓGICA] Dispositivo novo. Verificando se há vagas no plano...");
        
        if (registeredDeviceCount < maxDevices) {
            console.log(`[DECISÃO] PERMITIR. Novo dispositivo e há vaga (${registeredDeviceCount} < ${maxDevices}).`);
            await proceedWithLogin(email, currentDeviceId, registroPlano);
        } else {
            console.log(`[DECISÃO] BLOQUEAR. Limite do plano atingido (${registeredDeviceCount} >= ${maxDevices}).`);
            alert(`A sua conta já atingiu o limite de ${maxDevices} dispositivo(s) cadastrado(s).`);
        }

      } catch (err) {
        console.error("ERRO CRÍTICO no processo de login:", err);
        alert("Ocorreu um erro ao tentar fazer login. Verifique o console para mais detalhes.");
      }
    }


    // --- FUNÇÃO AUXILIAR PARA EVITAR REPETIÇÃO DE CÓDIGO ---
    async function proceedWithLogin(email, deviceId, registroPlano) {
        const ipResp = await fetch('https://api.ipify.org?format=json');
        const ipData = await ipResp.json();
        const ipAddress = ipData.ip;
        const deviceInfo = navigator.userAgent;
        const sessionToken = generateToken();
        
        const novaSessao = {
            email: email,
            session_token: sessionToken,
            login_date: getBrasiliaISOString(),
            device_info: deviceInfo,
            ip_address: ipAddress,
            device_id: deviceId
        };

        await fetch(`${supabaseUrl}/rest/v1/login_sessions`, {
            method: 'POST',
            headers: { apikey: supabaseKey, 'Content-Type': 'application/json' },
            body: JSON.stringify(novaSessao)
        });

        localStorage.setItem('user_email', email);
        localStorage.setItem('session_token', sessionToken);

        // --- ATUALIZA A INTERFACE ---
        ['introSection', 'promoPedido', 'planosSection', 'loginArea', 'orderSection'].forEach(id => {
            const el = document.getElementById(id);
            if (el) el.style.display = 'none';
        });

        const busca = document.getElementById('searchSection');
        busca.classList.remove('hidden');
        busca.style.display = '';
        busca.scrollIntoView({ behavior: 'smooth', block: 'start' });

        document.querySelector('a[href="#introSection"]').style.display = 'none';
        document.querySelector('a[href="#planosSection"]').style.display = 'none';
        document.getElementById('menuLogin').innerText = 'Sair';
        document.getElementById('menuLogin').setAttribute('onclick', 'logout()');
        document.querySelector('#searchSection .bg-gray-800').innerHTML =
            `<strong>Bem-vindo(a), ${registroPlano.nome}!</strong><br>` +
            `Plano: ${registroPlano.plano}<br>` +
            `Válido até: ${formatarData(registroPlano.data_expiracao)}`;

        mostrarMenuMobileAposLogin();

        // **CARREGAR PEDIDO SALVO (LUGAR CORRETO)**
        const draftRes = await fetch(
          `${supabaseUrl}/rest/v1/draft_orders?select=items&email=eq.${encodeURIComponent(email)}`, {
            method: 'GET',
            headers: {
              apikey: supabaseKey,
            }
          }
        );
        const [draft] = await draftRes.json();
        if (draft && Array.isArray(draft.items)) {
          orderItems = draft.items.map(i => ({
            rowIndex: i.rowIndex,
            modeloDigitado: i.modelo,
            quantidade: i.quantidade
          }));
          atualizarListaPedidos();
        }
    }

// Função de logout
async function logout() {
  const email = localStorage.getItem('user_email');
  const sessionToken = localStorage.getItem('session_token');
  if (!email || !sessionToken) return;

  // Limpa os dados locais imediatamente para uma experiência de usuário mais rápida
  localStorage.removeItem('user_email');
  localStorage.removeItem('login_date');
  localStorage.removeItem('session_token');

  // Restaura visibilidade das seções
  document.querySelector('a[href="#introSection"]').style.display = '';
  document.querySelector('a[href="#planosSection"]').style.display = '';
  ['introSection', 'promoPedido', 'planosSection'].forEach(id => {
      const el = document.getElementById(id);
      if (el) {
          el.classList.remove('hidden');
          el.style.display = ''; 
      }
  });
  
  // Esconde as seções de logado
  ['searchSection', 'orderSection'].forEach(id => {
      const el = document.getElementById(id);
      if (el) {
          el.classList.add('hidden');
          el.style.display = 'none';
      }
  });

  // Mostra a área de login novamente
  const loginArea = document.getElementById('loginArea');
  loginArea.classList.remove('hidden');
  loginArea.style.display = '';

  document.getElementById('menuLogin').innerText = 'Login';
  document.getElementById('menuLogin').setAttribute('onclick', 'goToLogin()');

  mostrarMenuMobileAposLogout();
  window.scrollTo({ top: 0, behavior: 'smooth' });
}


// Função de validação periódica de sessão (opcional, pode ser removida se não desejar)
async function validateSession() {
  const email = localStorage.getItem('user_email');
  const storedToken = localStorage.getItem('session_token');
  if (!email || !storedToken) return;

  try {
    const res = await fetch(
      `${supabaseUrl}/rest/v1/login_sessions?email=eq.${encodeURIComponent(email)}&session_token=eq.${encodeURIComponent(storedToken)}`,
      {
        method: 'GET',
        headers: {
          apikey: supabaseKey,
        }
      }
    );
    const result = await res.json();
    if (!result || result.length === 0) {
      // Se a sessão não é válida no backend, força o logout no frontend
      // logout(); 
      // Comentado para não deslogar o usuário abruptamente, mas pode ser ativado
    }
  } catch (err) {
    console.error('Erro na validação da sessão:', err);
  }
}
// setInterval(validateSession, 60000); // Executa a cada 1 minuto


    /** 13) Exibir/Ocultar Seções */
function mostrarInicio() {
  ['loginArea','searchSection','orderSection'].forEach(id => {
      const el = document.getElementById(id);
      if (el) {
          el.classList.add('hidden');
          el.style.display = 'none';
      }
  });

  ['introSection','promoPedido','planosSection'].forEach(id => {
      const el = document.getElementById(id);
      if (el) {
          el.classList.remove('hidden');
          el.style.display = '';
      }
  });

  document.getElementById('introSection')
          .scrollIntoView({ behavior: 'smooth', block: 'start' });
}


    function mostrarPlanos() {
  ['introSection','promoPedido','loginArea','searchSection','orderSection']
    .forEach(id => {
      const el = document.getElementById(id);
      el.classList.add('hidden');
      el.style.display = 'none';
    });

  const planos = document.getElementById('planosSection');
  planos.classList.remove('hidden');
  planos.style.display = '';
  planos.scrollIntoView({ behavior: 'smooth' });
}

    function goToLogin() {
  ['introSection','promoPedido','planosSection','searchSection','orderSection']
    .forEach(id => {
      const el = document.getElementById(id);
      if (el) {
        el.classList.add('hidden');
        el.style.display = 'none';
      }
    });

  const login = document.getElementById('loginArea');
  login.classList.remove('hidden');
  login.style.display = '';
  login.scrollIntoView({
    behavior: 'smooth',
    block: 'start'
  });
}


function mostrarPedidos() {
  ['introSection', 'promoPedido', 'planosSection','loginArea','searchSection'].forEach(id => {
    const el = document.getElementById(id);
    if (el) {
        el.classList.add('hidden');
        el.style.display = 'none';
    }
  });

  const order = document.getElementById('orderSection');
  order.classList.remove('hidden');
  order.style.display = '';
  order.scrollIntoView({
    behavior: 'smooth',
    block: 'start'
  });

  const modeloPesquisado = document.getElementById('searchModel').value.trim();
  if (modeloPesquisado) {
    document.getElementById('orderModelo').value = modeloPesquisado;
  }

  document.getElementById('orderModelo')?.focus();
}

// 17) Voltar à consulta de modelos mantendo o pedido atual
function voltarConsulta() {
  const order = document.getElementById('orderSection');
  order.classList.add('hidden');
  order.style.display = 'none';

  const search = document.getElementById('searchSection');
  search.classList.remove('hidden');
  search.style.display = '';
  search.scrollIntoView({
    behavior: 'smooth',
    block: 'start'
  });

  document.getElementById('searchModel')?.focus();
}


// 1) Função auxiliar para apagar o draft do Supabase
async function deleteDraft() {
  const email = localStorage.getItem("user_email");
  if (!email) return;
  try {
    await fetch(
      `${supabaseUrl}/rest/v1/draft_orders?email=eq.${email}`,
      {
        method: "DELETE",
        headers: {
          apikey:        supabaseKey,
        }
      }
    );
  } catch (err) {
    console.error("Erro ao deletar rascunho:", err);
  }
}
// 2) Limpar pedido local **e** no Supabase
function limparPedido() {
  if (confirm("Tem certeza que deseja limpar todos os itens do pedido? Esta ação não pode ser desfeita.")) {
    orderItems = [];
    atualizarListaPedidos();
    deleteDraft();
  }
}

    /* 14) Seções Legais */
    function mostrarLegal(secId) {
      document.getElementById('legalContentContainer').classList.remove('hidden');
      document.querySelectorAll('.legal-section').forEach(sec => sec.classList.add('hidden'));
      document.getElementById(secId).classList.remove('hidden');
      document.getElementById('legalContentContainer').scrollIntoView({ behavior: 'smooth' });
    }
    function fecharLegal() {
      document.getElementById('legalContentContainer').classList.add('hidden');
    }

    /* 15) Modais: Incompatibilidade e Compatibilidade */
    function abrirModalIncompatibilidade() {
      const modeloProcurado = document.getElementById('searchModel').value.trim();
      if (modeloProcurado) {
        document.getElementById('modeloTestado').value = modeloProcurado;
      }
      document.getElementById('modalIncompatibilidade').classList.remove('hidden');
    }
    function fecharModalIncompatibilidade() {
      document.getElementById('modalIncompatibilidade').classList.add('hidden');
    }
    async function enviarIncompatibilidade() {
  const modeloTestado = document.getElementById('modeloTestado').value.trim();
  const modeloIncompativel = document.getElementById('modeloIncompativel').value.trim();
  const email = localStorage.getItem("user_email") || null;

  if (!modeloTestado || !modeloIncompativel) {
    return alert("Preencha ambos os campos antes de enviar!");
  }

  try {
    const res = await fetch(`${supabaseUrl}/rest/v1/relatorios_pelicula`, {
      method: "POST",
      headers: {
        apikey: supabaseKey,
        "Content-Type": "application/json"
      },
      body: JSON.stringify([{
        tipo: "incompatibilidade",
        modelo_procurado: modeloTestado,
        modelo_informado: modeloIncompativel,
        email_usuario: email
      }])
    });

    if (!res.ok) throw new Error(await res.text());

    alert("📥 Registro de incompatibilidade enviado com sucesso!");
    fecharModalIncompatibilidade();
  } catch (err) {
    console.error(err);
    alert("❌ Falha ao enviar. Tente novamente.");
  }
}

    function abrirModalCompatibilidade() {
      const modeloProcurado = document.getElementById('searchModel').value.trim();
      if (modeloProcurado) {
        document.getElementById('modeloProcuradoCompat').value = modeloProcurado;
      }
      document.getElementById('modalCompatibilidade').classList.remove('hidden');
    }
    function fecharModalCompatibilidade() {
      document.getElementById('modalCompatibilidade').classList.add('hidden');
    }
    async function enviarCompatibilidade() {
  const modeloProcurado = document.getElementById('modeloProcuradoCompat').value.trim();
  const modeloCompativel = document.getElementById('modeloCompativel').value.trim();
  const email = localStorage.getItem("user_email") || null;

  if (!modeloProcurado || !modeloCompativel) {
    return alert("Preencha ambos os campos antes de enviar!");
  }

   try {
    const res = await fetch(`${supabaseUrl}/rest/v1/relatorios_pelicula`, {
      method: "POST",
      headers: {
        apikey: supabaseKey,
        "Content-Type": "application/json"
      },
      body: JSON.stringify([{
        tipo: "compatibilidade",
        modelo_procurado: modeloProcurado,
        modelo_informado: modeloCompativel,
        email_usuario: email
      }])
    });

    if (!res.ok) {
      throw new Error(await res.text());
    }

    alert("📥 Registro de compatibilidade enviado com sucesso!");
    fecharModalCompatibilidade();

  } catch (err) {
    console.error(err);
    alert("❌ Falha ao enviar. Tente novamente.");
  }
}

// Permite login ao pressionar ENTER no campo de e-mail
document.getElementById('email').addEventListener('keydown', function(event) {
  if (event.key === 'Enter') {
    event.preventDefault();
    checkEmail();
  }
});

// Inicialização
document.addEventListener('DOMContentLoaded', () => {
    loadData();
    // Verifica se já existe uma sessão ao carregar a página
    const email = localStorage.getItem('user_email');
    if (email) {
        // Se houver um e-mail, tenta revalidar o login silenciosamente
        // ou diretamente mostra a tela de logado.
        // Por simplicidade, vamos chamar a função de login de novo,
        // mas com o email já preenchido.
        checkEmailOnLoad();
    }
});

async function checkEmailOnLoad() {
    const email = localStorage.getItem('user_email');
    if (!email) return;

    // Coloca o e-mail no campo para a função `checkEmail` funcionar
    const emailInput = document.getElementById('email');
    if (emailInput) emailInput.value = email;

    // Roda a verificação de login
    await checkEmail();
}

  </script>
</body>
</ht
